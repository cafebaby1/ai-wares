
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®å®å¥åº·è®°å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --milk-primary: #FF8FA3;
            --milk-dark: #FF6B85;
            --milk-light: #FFF0F3;
            --medicine-primary: #6BCBFF;
            --medicine-dark: #4AA8FF;
            --medicine-light: #E8F7FF;
            --vitamin-primary: #FFD93D;
            --vitamin-dark: #FFB800;
            --vitamin-light: #FFFBE6;
            --food-primary: #7AE582;
            --food-dark: #5BC45F;
            --food-light: #E8F9E9;
            --other-primary: #C084FC;
            --other-dark: #A855F7;
            --other-light: #F3E8FF;
            --bg-gradient-start: #E0F7FA;
            --bg-gradient-mid: #FCE4EC;
            --bg-gradient-end: #F3E5F5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-mid) 50%, var(--bg-gradient-end) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨æ ‡é¢˜æ  - ç»ç’ƒæ‹Ÿæ€æ•ˆæœ */
        .header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 12px 15px 15px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            text-align: center;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .date {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
            font-weight: 500;
            letter-spacing: 1px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .date:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .date::after {
            content: 'â–¼';
            font-size: 8px;
        }

        .title {
            font-size: 22px;
            font-weight: 800;
            color: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .title .icon {
            font-size: 28px;
            animation: gentle-bounce 2s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-4px) rotate(3deg); }
        }

        /* ç»Ÿè®¡å¡ç‰‡ - æ¸å˜è‰²å½© */
        .stats {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            padding-top: 10px;
        }

        .stat-item {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            min-width: 80px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transform: translateY(0);
            transition: transform 0.2s;
        }

        .stat-item:active {
            transform: translateY(2px);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.95;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* ä¸»å†…å®¹åŒº */
        .main {
            flex: 1;
            padding: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            gap: 10px;
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.7);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .time-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .top-actions {
            display: flex;
            gap: 8px;
        }

        .edit-btn, .history-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(102,126,234,0.3);
            transition: all 0.2s;
        }

        .history-btn {
            background: linear-gradient(135deg, #FF8FA3 0%, #FF6B85 100%);
            box-shadow: 0 3px 10px rgba(255, 107, 133, 0.3);
        }

        .edit-btn:active, .history-btn:active {
            transform: scale(0.95);
        }

        /* é¡¹ç›®å®¹å™¨ - åœ†è§’å¡ç‰‡ */
        .items-container {
            flex: 1;
            overflow-y: auto;
            background: rgba(255,255,255,0.5);
            border-radius: 20px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }

        .item-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        /* æŒ‰é’®åŸºç¡€æ ·å¼ - 3Dæ•ˆæœ */
        .item-btn {
            border: none;
            border-radius: 18px;
            padding: 8px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            transition: all 0.2s;
            position: relative;
            min-height: 95px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.15), 0 8px 20px rgba(0,0,0,0.1);
        }

        .item-btn:active:not(.disabled) {
            transform: translateY(6px);
            box-shadow: 0 0 0 rgba(0,0,0,0.15), 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ç‰›å¥¶ - ç²‰è‰²æ£‰èŠ±ç³– */
        .type-milk {
            background: linear-gradient(180deg, var(--milk-light) 0%, var(--milk-primary) 100%);
            color: #C2185B;
        }
        .type-milk .item-icon { filter: drop-shadow(0 2px 3px rgba(194, 24, 89, 0.2)); }
        .type-milk.next {
            animation: pulse-milk 2s infinite;
            box-shadow: 0 6px 0 var(--milk-dark), 0 8px 25px rgba(255, 107, 133, 0.4);
        }
        @keyframes pulse-milk {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--milk-dark), 0 8px 25px rgba(255, 107, 133, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--milk-dark), 0 12px 30px rgba(255, 107, 133, 0.6); }
        }

        /* è¯ç‰© - æ¸…æ–°è“ */
        .type-medicine {
            background: linear-gradient(180deg, var(--medicine-light) 0%, var(--medicine-primary) 100%);
            color: #1565C0;
        }
        .type-medicine .item-icon { filter: drop-shadow(0 2px 3px rgba(21, 101, 192, 0.2)); }
        .type-medicine.next {
            animation: pulse-medicine 2s infinite;
            box-shadow: 0 6px 0 var(--medicine-dark), 0 8px 25px rgba(74, 168, 255, 0.4);
        }
        @keyframes pulse-medicine {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--medicine-dark), 0 8px 25px rgba(74, 168, 255, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--medicine-dark), 0 12px 30px rgba(74, 168, 255, 0.6); }
        }

        /* ç»´ç”Ÿç´  - é˜³å…‰é»„ */
        .type-vitamin {
            background: linear-gradient(180deg, var(--vitamin-light) 0%, var(--vitamin-primary) 100%);
            color: #E65100;
        }
        .type-vitamin .item-icon { filter: drop-shadow(0 2px 3px rgba(230, 81, 0, 0.2)); }
        .type-vitamin.next {
            animation: pulse-vitamin 2s infinite;
            box-shadow: 0 6px 0 var(--vitamin-dark), 0 8px 25px rgba(255, 184, 0, 0.4);
        }
        @keyframes pulse-vitamin {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--vitamin-dark), 0 8px 25px rgba(255, 184, 0, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--vitamin-dark), 0 12px 30px rgba(255, 184, 0, 0.6); }
        }

        /* è¾…é£Ÿ - æ¸…æ–°ç»¿ */
        .type-food {
            background: linear-gradient(180deg, var(--food-light) 0%, var(--food-primary) 100%);
            color: #2E7D32;
        }
        .type-food .item-icon { filter: drop-shadow(0 2px 3px rgba(46, 125, 50, 0.2)); }
        .type-food.next {
            animation: pulse-food 2s infinite;
            box-shadow: 0 6px 0 var(--food-dark), 0 8px 25px rgba(91, 196, 95, 0.4);
        }
        @keyframes pulse-food {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--food-dark), 0 8px 25px rgba(91, 196, 95, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--food-dark), 0 12px 30px rgba(91, 196, 95, 0.6); }
        }

        /* å…¶ä»– - æ¢¦å¹»ç´« */
        .type-other {
            background: linear-gradient(180deg, var(--other-light) 0%, var(--other-primary) 100%);
            color: #7B1FA2;
        }
        .type-other .item-icon { filter: drop-shadow(0 2px 3px rgba(123, 31, 162, 0.2)); }
        .type-other.next {
            animation: pulse-other 2s infinite;
            box-shadow: 0 6px 0 var(--other-dark), 0 8px 25px rgba(168, 85, 247, 0.4);
        }
        @keyframes pulse-other {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--other-dark), 0 8px 25px rgba(168, 85, 247, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--other-dark), 0 12px 30px rgba(168, 85, 247, 0.6); }
        }

        /* å®ŒæˆçŠ¶æ€ - ç»Ÿä¸€ç»¿è‰² */
        .item-btn.completed {
            background: linear-gradient(180deg, #E8F5E9 0%, #81C784 100%) !important;
            color: #1B5E20 !important;
            box-shadow: 0 2px 0 #4CAF50, 0 4px 10px rgba(76, 175, 80, 0.3) !important;
            transform: translateY(4px);
        }

        .item-btn.completed::after {
            content: 'âœ“';
            position: absolute;
            top: -6px;
            right: -6px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop-in {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* ç¦ç”¨çŠ¶æ€ */
        .item-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.6) brightness(0.9);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.1) !important;
            transform: translateY(4px);
        }

        /* è­¦å‘ŠçŠ¶æ€ */
        .item-btn.warning {
            animation: shake 0.5s ease-in-out infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-3px) translateY(0); }
            75% { transform: translateX(3px) translateY(0); }
        }

        /* ç´§æ€¥çŠ¶æ€ */
        .item-btn.urgent {
            animation: urgent-pulse 0.8s infinite;
        }
        @keyframes urgent-pulse {
            0%, 100% { transform: scale(1) translateY(0); box-shadow: 0 6px 0 #d32f2f, 0 8px 20px rgba(211, 47, 47, 0.4); }
            50% { transform: scale(1.03) translateY(-2px); box-shadow: 0 8px 0 #d32f2f, 0 12px 30px rgba(211, 47, 47, 0.6); }
        }

        /* æŒ‰é’®å†…å®¹ - æ—¶é—´å’Œå®¹é‡ä½ç½®äº’æ¢ */
        .item-icon {
            font-size: 24px;
            line-height: 1;
        }

        .item-name {
            font-size: 14px;
            font-weight: 700;
            color: inherit;
            text-align: center;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255,255,255,0.4);
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            backdrop-filter: blur(4px);
        }

        /* å®¹é‡è¾“å…¥æ¡† */
        .item-amount-input {
            font-size: 12px;
            color: inherit;
            background: rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 3px 6px;
            border-radius: 8px;
            width: 90%;
            text-align: center;
            font-weight: 600;
            outline: none;
        }

        .item-amount-input:focus {
            background: rgba(255,255,255,0.9);
            border-color: rgba(255,255,255,0.8);
        }

        .item-btn.completed .item-amount-input {
            background: rgba(255,255,255,0.4);
            border-color: transparent;
            color: #1B5E20;
        }

        .item-time {
            font-size: 11px;
            font-weight: 700;
            color: inherit;
            background: rgba(255,255,255,0.5);
            padding: 3px 10px;
            border-radius: 12px;
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .item-btn.completed .item-time {
            background: rgba(255,255,255,0.6);
            color: #1B5E20;
        }

        /* ç­‰å¾…æ ‡ç­¾ */
        .wait-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
            white-space: nowrap;
            box-shadow: 0 3px 10px rgba(238, 90, 111, 0.4);
            z-index: 5;
            border: 2px solid white;
            animation: badge-bounce 1s infinite;
        }

        @keyframes badge-bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }

        .urgent-text {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #d32f2f, #c62828);
            color: white;
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
            animation: blink 0.6s infinite;
            box-shadow: 0 2px 8px rgba(211, 47, 47, 0.4);
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* å¤§ä¾¿è®°å½•åŒº - æ”¾åœ¨æœ€åº•éƒ¨ï¼ŒæŒ‰é’®æ›´çŸ®ä½†æ–‡å­—æ­£å¸¸å¤§å° */
        .poop-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 10px 12px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.6);
            margin-top: auto;
            order: 999;
        }

        .poop-title {
            font-size: 13px;
            color: #8D6E63;
            text-align: center;
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .poop-title::before,
        .poop-title::after {
            content: 'â€¢';
            color: #BCAAA4;
        }

        .poop-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .poop-btn {
            flex: 1;
            background: linear-gradient(180deg, #FFF8E1 0%, #FFCC80 100%);
            border: none;
            border-radius: 10px;
            padding: 4px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 0 #FF9800, 0 3px 8px rgba(255, 152, 0, 0.2);
            transition: all 0.2s;
            color: #E65100;
            position: relative;
            overflow: hidden;
            height: 28px;
        }

        .poop-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%);
            pointer-events: none;
        }

        .poop-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #FF9800, 0 2px 5px rgba(255, 152, 0, 0.2);
        }

        .poop-btn .icon {
            font-size: 16px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        .poop-btn .label {
            font-size: 14px;
            font-weight: 700;
        }

        .poop-btn .count {
            font-size: 12px;
            background: rgba(255,255,255,0.6);
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 20px;
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .poop-list {
            max-height: 60px;
            overflow-y: auto;
            font-size: 11px;
            color: #8D6E63;
            text-align: center;
            padding: 6px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }

        .poop-list:empty {
            display: none;
        }

        .poop-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #D7CCC8, #BCAAA4);
            color: #5D4037;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* åº•éƒ¨æŒ‰é’®ç»„ - ä¿å­˜å’Œé‡ç½®åˆ†å¼€ */
        .bottom-actions {
            display: flex;
            gap: 10px;
            margin-top: 4px;
            order: 1000;
        }

        .save-btn, .reset-btn {
            flex: 1;
            border: none;
            padding: 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 0 #5a67d8, 0 6px 15px rgba(102, 126, 234, 0.3);
        }

        .save-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #5a67d8, 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .reset-btn {
            background: linear-gradient(135deg, #FFE0B2 0%, #FFCC80 100%);
            color: #E65100;
            box-shadow: 0 4px 0 #FF9800, 0 6px 15px rgba(255, 152, 0, 0.2);
        }

        .reset-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #FF9800, 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        /* æ¨¡æ€æ¡† */
        .config-modal, .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .config-modal.show, .history-modal.show {
            display: flex;
        }

        .config-content, .history-content {
            background: white;
            border-radius: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            animation: slide-up 0.3s ease;
            overflow: hidden;
        }

        @keyframes slide-up {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .config-header, .history-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }

        .history-header {
            background: linear-gradient(135deg, #FF8FA3 0%, #FF6B85 100%);
        }

        .config-header h2, .history-header h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }

        .config-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #F5F7FA;
        }

        /* å†å²è®°å½•åˆ—è¡¨æ ·å¼ */
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #F5F7FA;
        }

        .history-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            position: relative;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-item.active {
            border-color: #667eea;
            background: #F0F4FF;
        }

        .history-date {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-date::before {
            content: 'ğŸ“…';
        }

        .history-time {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            padding-left: 28px;
        }

        .history-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
        }

        .history-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .history-stat::before {
            content: 'â€¢';
            color: #999;
        }

        /* åˆ é™¤æŒ‰é’® */
        .history-delete {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(238, 90, 111, 0.3);
            transition: all 0.2s;
            z-index: 10;
        }

        .history-delete:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(238, 90, 111, 0.4);
        }

        .history-delete:active {
            transform: scale(0.95);
        }

        .history-empty {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        .history-empty::before {
            content: 'ğŸ“­';
            display: block;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .title-edit {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 12px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .title-edit input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .title-edit input:focus {
            outline: none;
            border-color: #667eea;
        }

        .title-edit button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }

        .poop-config {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .poop-config-title {
            font-size: 14px;
            color: #555;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .poop-config-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .poop-config-item span {
            font-size: 20px;
        }

        .poop-config-item input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .poop-config-item input:focus {
            outline: none;
            border-color: #FF9800;
        }

        .drag-hint {
            text-align: center;
            font-size: 12px;
            color: #667eea;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            font-weight: 500;
            border: 2px dashed rgba(102, 126, 234, 0.3);
        }

        .sortable-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            position: relative;
            touch-action: none;
            user-select: none;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: move;
        }

        .sortable-item.dragging {
            opacity: 0.6;
            border-color: #667eea;
            transform: scale(1.02) rotate(2deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .sortable-item.drag-over {
            border-top: 3px solid #667eea;
            transform: translateY(5px);
        }

        .drag-handle {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #BBB;
            font-size: 20px;
            cursor: grab;
            padding: 5px;
            touch-action: none;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .sortable-content {
            margin-left: 35px;
            margin-right: 40px;
        }

        .sortable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sortable-name {
            font-weight: 700;
            color: #333;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sortable-type {
            font-size: 11px;
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .type-tag-milk { background: linear-gradient(135deg, #FF8FA3, #FF6B85); }
        .type-tag-medicine { background: linear-gradient(135deg, #6BCBFF, #4AA8FF); }
        .type-tag-vitamin { background: linear-gradient(135deg, #FFD93D, #FFB800); color: #333; }
        .type-tag-food { background: linear-gradient(135deg, #7AE582, #5BC45F); }
        .type-tag-other { background: linear-gradient(135deg, #C084FC, #A855F7); }

        .sortable-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }

        .sortable-setting {
            background: #F5F7FA;
            padding: 10px;
            border-radius: 10px;
        }

        .sortable-setting label {
            display: block;
            font-size: 10px;
            color: #999;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sortable-setting input, .sortable-setting select {
            width: 100%;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            padding: 8px;
            font-size: 13px;
            transition: border-color 0.2s;
            background: white;
        }

        .sortable-setting input:focus, .sortable-setting select:focus {
            outline: none;
            border-color: #667eea;
        }

        .sortable-delete {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(238, 90, 111, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sortable-delete:active {
            transform: translateY(-50%) scale(0.9);
        }

        .config-add-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .config-add-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .add-item-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .config-actions {
            padding: 20px;
            background: white;
            border-top: 1px solid #EEE;
            display: flex;
            gap: 12px;
        }

        .config-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s;
        }

        .config-btn.cancel {
            background: #F5F7FA;
            color: #666;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .config-btn.cancel:active {
            background: #E0E0E0;
        }

        .config-btn.save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .config-btn.save:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* Toast æç¤º */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(51, 51, 51, 0.95);
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 300;
            white-space: nowrap;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* åº†ç¥å¼¹çª— */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            z-index: 250;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .celebration-overlay.show {
            display: flex;
        }

        .celebration {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 30px 80px rgba(0,0,0,0.3);
            animation: celebration-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 300px;
            width: 90%;
        }

        @keyframes celebration-pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration-icon {
            font-size: 70px;
            margin-bottom: 15px;
            animation: celebration-bounce 1s ease infinite;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        @keyframes celebration-bounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .celebration h2 {
            font-size: 26px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .celebration p {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            animation: confetti-fall 3s ease-out forwards;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        @keyframes confetti-fall {
            0% { 
                transform: translateY(-20px) rotate(0deg) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(100vh) rotate(720deg) scale(0.5); 
                opacity: 0; 
            }
        }

        .hidden {
            display: none !important;
        }

        /* æ»šåŠ¨æ¡ç¾åŒ– */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-height: 700px) {
            .item-btn {
                min-height: 85px;
                padding: 6px 4px;
            }
            .item-icon {
                font-size: 22px;
            }
        }

        @media (min-height: 800px) {
            .item-row {
                margin-bottom: 12px;
            }
            .item-btn {
                min-height: 105px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="date" id="currentDate" onclick="openHistory()">1æœˆ1æ—¥</div>
        <div class="title"><span class="icon" id="titleIcon">ğŸ¼</span> <span id="titleText">å®å®å–‚å¥¶è®°å½•</span></div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="completedCount">0</div>
                <div class="stat-label" id="completedLabel">å–å¥¶å®Œæˆ</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="remainingCount">0</div>
                <div class="stat-label" id="remainingLabel">å–å¥¶å‰©ä½™</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalAmount">0</div>
                <div class="stat-label" id="amountLabel">å¥¶é‡(ml)</div>
            </div>
        </div>
    </div>

    <div class="main">
        <!-- ç›´æ¥è¿›å…¥ä¸»ç•Œé¢ï¼Œæ²¡æœ‰å¼€å§‹é¡µé¢ -->
        <div class="top-bar" id="topBar">
            <div class="time-toggle">
                <span>â° æ—¶é—´é™åˆ¶</span>
                <div class="toggle-switch active" id="toggleSwitch" onclick="toggleTimeLimit()"></div>
            </div>
            <div class="top-actions">
                <button class="history-btn" onclick="openHistory()">ğŸ“… å†å²</button>
                <button class="edit-btn" onclick="openConfig()">âš™ï¸ è®¾ç½®</button>
            </div>
        </div>

        <div class="items-container" id="itemsContainer"></div>

        <!-- å¤§ä¾¿è®°å½•æ”¾åœ¨æœ€åº•éƒ¨ -->
        <div class="poop-section" id="poopSection">
            <div class="poop-title">ğŸ’© å¤§ä¾¿è®°å½•</div>
            <div class="poop-buttons">
                <button class="poop-btn" onclick="recordPoop('normal')">
                    <span class="icon">ğŸ’©</span>
                    <span class="label" id="poopLabelNormal">æ­£å¸¸ä¾¿</span>
                    <span class="count" id="poopNormal">0</span>
                </button>
                <button class="poop-btn" onclick="recordPoop('diarrhea')">
                    <span class="icon">ğŸ’§</span>
                    <span class="label" id="poopLabelDiarrhea">ç¨€ä¾¿</span>
                    <span class="count" id="poopDiarrhea">0</span>
                </button>
                <button class="poop-btn" onclick="recordPoop('hard')">
                    <span class="icon">ğŸ«</span>
                    <span class="label" id="poopLabelHard">ç¡¬ä¾¿</span>
                    <span class="count" id="poopHard">0</span>
                </button>
            </div>
            <div class="poop-list" id="poopList"></div>
        </div>

        <!-- åº•éƒ¨æŒ‰é’®ç»„ï¼šä¿å­˜å’Œé‡ç½®åˆ†å¼€ -->
        <div class="bottom-actions">
            <button class="save-btn" id="saveBtn" onclick="saveDayRecord()">
                <span>ğŸ’¾</span> ä¿å­˜è®°å½•
            </button>
            <button class="reset-btn" id="resetBtn" onclick="resetCurrentDay()">
                <span>ğŸ”„</span> å¼€å§‹æ–°è®°å½•
            </button>
        </div>
    </div>

    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div class="config-modal" id="configModal">
        <div class="config-content">
            <div class="config-header">
                <h2>âš™ï¸ è‡ªå®šä¹‰é…ç½®</h2>
            </div>
            
            <div class="config-list" id="configList">
                <div class="title-edit">
                    <input type="text" id="titleInput" placeholder="è¾“å…¥æ ‡é¢˜" value="å®å®å–‚å¥¶è®°å½•">
                    <button onclick="updateTitle()">ä¿®æ”¹</button>
                </div>

                <div class="poop-config">
                    <div class="poop-config-title">ğŸ’© å¤§ä¾¿æŒ‰é’®æ–‡å­—</div>
                    <div class="poop-config-item">
                        <span>ğŸ’©</span>
                        <input type="text" id="poopInputNormal" value="æ­£å¸¸ä¾¿" placeholder="æŒ‰é’®æ–‡å­—">
                    </div>
                    <div class="poop-config-item">
                        <span>ğŸ’§</span>
                        <input type="text" id="poopInputDiarrhea" value="ç¨€ä¾¿" placeholder="æŒ‰é’®æ–‡å­—">
                    </div>
                    <div class="poop-config-item">
                        <span>ğŸ«</span>
                        <input type="text" id="poopInputHard" value="ç¡¬ä¾¿" placeholder="æŒ‰é’®æ–‡å­—">
                    </div>
                </div>

                <div class="drag-hint">ğŸ‘† æŒ‰ä½ â˜° æ‹–åŠ¨æ’åºï¼Œå–å¥¶ç¼–å·ä¼šè‡ªåŠ¨æ›´æ–°</div>
                <div id="sortableItems"></div>
                <button class="config-add-btn" onclick="showAddForm()">+ æ·»åŠ é¡¹ç›®</button>
                
                <div class="add-item-form hidden" id="addForm">
                    <div class="form-group">
                        <label>é¡¹ç›®åç§°</label>
                        <input type="text" id="newItemName" placeholder="å¦‚ï¼šå–ç‰›å¥¶ã€åƒè¯">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å›¾æ ‡</label>
                            <select id="newItemIcon">
                                <option value="ğŸ¥›">ğŸ¥› ç‰›å¥¶</option>
                                <option value="ğŸ’Š">ğŸ’Š è¯</option>
                                <option value="â˜€ï¸">â˜€ï¸ ç»´D</option>
                                <option value="ğŸš">ğŸš è¾…é£Ÿ</option>
                                <option value="ğŸ’§">ğŸ’§ æ°´</option>
                                <option value="ğŸ¼">ğŸ¼ å¥¶ç“¶</option>
                                <option value="ğŸ¥„">ğŸ¥„ å‹ºå­</option>
                                <option value="âœ¨">âœ¨ å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç±»å‹</label>
                            <select id="newItemType" onchange="updateTypeOptions()">
                                <option value="milk">ç‰›å¥¶ï¼ˆå‚ä¸ç¼–å·ç»Ÿè®¡ï¼‰</option>
                                <option value="medicine">è¯ç‰©</option>
                                <option value="vitamin">ç»´ç”Ÿç´ </option>
                                <option value="food">è¾…é£Ÿ</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>å‰‚é‡/æ•°é‡</label>
                            <input type="text" id="newItemAmount" placeholder="å¦‚ï¼š300ml">
                        </div>
                        <div class="form-group">
                            <label>ä¸ä¸Šæ¬¡é—´éš”</label>
                            <select id="newItemInterval">
                                <option value="0">æ— é™åˆ¶</option>
                                <option value="30">30åˆ†é’Ÿ</option>
                                <option value="60" selected>1å°æ—¶</option>
                                <option value="120">2å°æ—¶</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="specialIntervalGroup" style="display: none;">
                        <label>ä¸ç‰›å¥¶é—´éš”ï¼ˆåˆ†é’Ÿï¼ŒåŒå‘ï¼‰</label>
                        <input type="number" id="newItemSpecialInterval" placeholder="å¦‚ï¼š30" value="30">
                    </div>
                    <div class="config-actions" style="padding: 0; margin-top: 10px;">
                        <button class="config-btn cancel" onclick="hideAddForm()">å–æ¶ˆ</button>
                        <button class="config-btn save" onclick="addNewItem()">æ·»åŠ </button>
                    </div>
                </div>
            </div>
            
            <div class="config-actions">
                <button class="config-btn cancel" onclick="closeConfig()">å–æ¶ˆ</button>
                <button class="config-btn save" onclick="saveConfig()">ä¿å­˜å¹¶å¼€å§‹</button>
            </div>
        </div>
    </div>

    <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <div class="history-header">
                <h2>ğŸ“… å†å²è®°å½•</h2>
            </div>
            <div class="history-list" id="historyList">
                <!-- å†å²è®°å½•åˆ—è¡¨ -->
            </div>
            <div class="config-actions">
                <button class="config-btn cancel" onclick="closeHistory()">å…³é—­</button>
                <button class="config-btn save" onclick="backToToday()">å›åˆ°ä»Šå¤©</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    
    <div class="celebration-overlay" id="celebrationOverlay" onclick="closeCelebration()">
        <div class="celebration" id="celebration" onclick="event.stopPropagation()">
            <div class="celebration-icon">ğŸ‰</div>
            <h2>ä»Šæ—¥å®Œæˆï¼</h2>
            <p id="celebrationText">å®å®çœŸæ£’ï¼</p>
        </div>
    </div>

    <script>
        // å­˜å‚¨é”®å
        const STORAGE_KEY = 'taotaoHealthRecords';
        const CONFIG_KEY = 'taotaoHealthConfig';
        
        // é»˜è®¤é…ç½®
        const defaultConfig = {
            title: 'å®å®å–‚å¥¶è®°å½•',
            icon: 'ğŸ¼',
            trackType: 'milk',
            items: [
                { id: 1, name: '1', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 2, name: '2', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 3, name: '3', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 'vit', name: 'ç»´D', icon: 'â˜€ï¸', type: 'vitamin', amount: '1æ»´', interval: 30, specialInterval: { type: 'milk', minutes: 30 } },
                { id: 4, name: '4', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 5, name: '5', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 6, name: '6', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 7, name: '7', icon: 'ğŸ¥›', type: 'milk', amount: '300ml', interval: 60 },
                { id: 'med', name: 'æ°¯å¡æ ¼é›·', icon: 'ğŸ’Š', type: 'medicine', amount: '4/5ç‰‡', interval: 0, specialInterval: { type: 'milk', minutes: 30 } }
            ],
            poopLabels: {
                normal: 'æ­£å¸¸ä¾¿',
                diarrhea: 'ç¨€ä¾¿',
                hard: 'ç¡¬ä¾¿'
            }
        };

        // å…¨å±€çŠ¶æ€
        let config = JSON.parse(JSON.stringify(defaultConfig));
        let currentDate = new Date().toDateString();
        let records = [];
        let poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
        let timeLimitEnabled = true;
        let checkInterval;
        let draggedItem = null;
        let isViewingHistory = false;

        // åˆå§‹åŒ–
        function init() {
            loadConfig();
            loadTodayData();
            updateDateDisplay();
            startDay();
        }

        // åŠ è½½é…ç½®
        function loadConfig() {
            const savedConfig = localStorage.getItem(CONFIG_KEY);
            if (savedConfig) {
                config = JSON.parse(savedConfig);
            }
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
        }

        // åŠ è½½æŒ‡å®šæ—¥æœŸçš„æ•°æ®
        function loadDateData(dateStr) {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const dayData = allData[dateStr];
            
            if (dayData) {
                // å¦‚æœæœ‰å¤šä¸ªè®°å½•ï¼Œå–æœ€æ–°çš„ä¸€ä¸ª
                if (Array.isArray(dayData)) {
                    const latest = dayData[dayData.length - 1];
                    records = latest.records || [];
                    poopRecords = latest.poopRecords || { normal: 0, diarrhea: 0, hard: 0, times: [] };
                    timeLimitEnabled = latest.timeLimitEnabled !== undefined ? latest.timeLimitEnabled : true;
                } else {
                    records = dayData.records || [];
                    poopRecords = dayData.poopRecords || { normal: 0, diarrhea: 0, hard: 0, times: [] };
                    timeLimitEnabled = dayData.timeLimitEnabled !== undefined ? dayData.timeLimitEnabled : true;
                }
            } else {
                // æ–°æ—¥æœŸï¼Œé‡ç½®æ•°æ®
                records = [];
                poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
                timeLimitEnabled = true;
            }
            
            currentDate = dateStr;
            updateDateDisplay();
        }

        // åŠ è½½ä»Šå¤©æ•°æ®
        function loadTodayData() {
            const today = new Date().toDateString();
            loadDateData(today);
            isViewingHistory = false;
        }

        // ä¿å­˜å½“å‰æ—¥æœŸæ•°æ®ï¼ˆä¸è¦†ç›–ï¼Œè¿½åŠ ï¼‰
        function saveCurrentData() {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const newRecord = {
                records: JSON.parse(JSON.stringify(records)),
                poopRecords: JSON.parse(JSON.stringify(poopRecords)),
                timeLimitEnabled,
                savedAt: new Date().toISOString()
            };
            
            // å¦‚æœè¯¥æ—¥æœŸå·²æœ‰è®°å½•ï¼Œè½¬ä¸ºæ•°ç»„å­˜å‚¨å¤šä¸ªè®°å½•
            if (allData[currentDate]) {
                if (Array.isArray(allData[currentDate])) {
                    allData[currentDate].push(newRecord);
                } else {
                    allData[currentDate] = [allData[currentDate], newRecord];
                }
            } else {
                allData[currentDate] = newRecord;
            }
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
        }

        // åˆ é™¤æŒ‡å®šæ—¥æœŸçš„æŒ‡å®šè®°å½•
        function deleteHistoryRecord(dateStr, recordIndex) {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            
            if (!allData[dateStr]) return false;
            
            if (Array.isArray(allData[dateStr])) {
                // åˆ é™¤æ•°ç»„ä¸­çš„æŒ‡å®šè®°å½•
                allData[dateStr].splice(recordIndex, 1);
                // å¦‚æœæ•°ç»„ä¸ºç©ºï¼Œåˆ é™¤è¯¥æ—¥æœŸ
                if (allData[dateStr].length === 0) {
                    delete allData[dateStr];
                } else if (allData[dateStr].length === 1) {
                    // å¦‚æœåªå‰©ä¸€ä¸ªï¼Œè½¬å›å¯¹è±¡æ ¼å¼
                    allData[dateStr] = allData[dateStr][0];
                }
            } else {
                // åˆ é™¤å•ä¸ªè®°å½•
                delete allData[dateStr];
            }
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
            return true;
        }

        // ä¿å­˜è®°å½•æŒ‰é’®åŠŸèƒ½ï¼ˆä»…ä¿å­˜ï¼Œä¸é‡ç½®ï¼‰
        function saveDayRecord() {
            if (isViewingHistory) {
                showToast('å†å²è®°å½•ä¸èƒ½ä¿å­˜');
                return;
            }
            
            // ä¿å­˜å½“å‰è®°å½•
            saveCurrentData();
            
            showToast('ğŸ’¾ è®°å½•å·²ä¿å­˜');
            
            // æ·»åŠ ä¿å­˜åŠ¨ç”»æ•ˆæœ
            const btn = document.getElementById('saveBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 200);
        }

        // é‡ç½®æŒ‰é’®åŠŸèƒ½ï¼ˆä»…é‡ç½®ï¼Œä¸ä¿å­˜ï¼‰
        function resetCurrentDay() {
            if (isViewingHistory) {
                // å¦‚æœæ˜¯æŸ¥çœ‹å†å²è®°å½•ï¼Œå›åˆ°ä»Šå¤©
                backToToday();
                return;
            }
            
            // ç¡®è®¤å¯¹è¯æ¡†
            if (records.length > 0 || poopRecords.times.length > 0) {
                if (!confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰è®°å½•å¹¶å¼€å§‹æ–°è®°å½•å—ï¼Ÿ\nï¼ˆè¯·å…ˆç‚¹å‡»"ä¿å­˜è®°å½•"ä¿å­˜å½“å‰æ•°æ®ï¼‰')) {
                    return;
                }
            }
            
            // é‡ç½®å½“å‰æ•°æ®
            records = [];
            poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
            timeLimitEnabled = true;
            
            document.getElementById('toggleSwitch').classList.add('active');
            
            renderItems();
            updateStats();
            updatePoopDisplay();
            
            if (checkInterval) clearInterval(checkInterval);
            checkInterval = setInterval(updateButtonStates, 10000);
            
            document.getElementById('celebrationOverlay').classList.remove('show');
            
            showToast('ğŸ”„ å·²å¼€å§‹æ–°è®°å½•');
            
            // æ·»åŠ é‡ç½®åŠ¨ç”»æ•ˆæœ
            const btn = document.getElementById('resetBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 200);
        }

        // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
        function updateDateDisplay() {
            const date = new Date(currentDate);
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            let dateText;
            if (currentDate === today) {
                dateText = 'ä»Šå¤©';
            } else if (currentDate === yesterday) {
                dateText = 'æ˜¨å¤©';
            } else {
                dateText = date.toLocaleDateString('zh-CN', {
                    month: 'short',
                    day: 'numeric',
                    weekday: 'short'
                });
            }
            
            document.getElementById('currentDate').textContent = dateText;
        }

        // å¼€å§‹/åˆ·æ–°ç•Œé¢
        function startDay() {
            document.getElementById('titleText').textContent = config.title;
            document.getElementById('titleIcon').textContent = config.icon;
            
            document.getElementById('poopLabelNormal').textContent = config.poopLabels.normal;
            document.getElementById('poopLabelDiarrhea').textContent = config.poopLabels.diarrhea;
            document.getElementById('poopLabelHard').textContent = config.poopLabels.hard;
            
            // æ ¹æ®æ˜¯å¦æ˜¯å†å²è®°å½•è°ƒæ•´ç•Œé¢
            const today = new Date().toDateString();
            const isToday = currentDate === today;
            
            // å†å²è®°å½•ç¦ç”¨æ—¶é—´é™åˆ¶å¼€å…³å’Œä¿å­˜æŒ‰é’®
            if (!isToday) {
                document.getElementById('toggleSwitch').classList.remove('active');
                document.getElementById('saveBtn').style.display = 'none';
                document.getElementById('resetBtn').innerHTML = '<span>ğŸ </span> å›åˆ°ä»Šå¤©';
                isViewingHistory = true;
            } else {
                if (!timeLimitEnabled) {
                    document.getElementById('toggleSwitch').classList.remove('active');
                } else {
                    document.getElementById('toggleSwitch').classList.add('active');
                }
                document.getElementById('saveBtn').style.display = 'flex';
                document.getElementById('resetBtn').innerHTML = '<span>ğŸ”„</span> å¼€å§‹æ–°è®°å½•';
                isViewingHistory = false;
            }
            
            updateStatsLabels();
            renderItems();
            updateStats();
            updatePoopDisplay();
            
            if (checkInterval) clearInterval(checkInterval);
            if (isToday) {
                checkInterval = setInterval(updateButtonStates, 10000);
            }
        }

        function updateStatsLabels() {
            document.getElementById('completedLabel').textContent = 'å–å¥¶å®Œæˆ';
            document.getElementById('remainingLabel').textContent = 'å–å¥¶å‰©ä½™';
            document.getElementById('amountLabel').textContent = 'å¥¶é‡(ml)';
        }

        function renderItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';
            
            let milkIndex = 1;
            config.items.forEach(item => {
                if (item.type === 'milk') {
                    item.name = String(milkIndex++);
                }
            });
            
            for (let i = 0; i < config.items.length; i += 4) {
                const row = document.createElement('div');
                row.className = 'item-row';
                
                for (let j = i; j < Math.min(i + 4, config.items.length); j++) {
                    const item = config.items[j];
                    const record = records.find(r => r.id === item.id);
                    const isCompleted = record && record.completed;
                    
                    const btn = document.createElement('button');
                    btn.className = `item-btn type-${item.type}`;
                    btn.id = `item-${item.id}`;
                    
                    // å†å²è®°å½•æˆ–å·²å®Œæˆçš„é¡¹ç›®ä¸å¯ç‚¹å‡»
                    if (!isViewingHistory && !isCompleted) {
                        btn.onclick = () => recordItem(item.id);
                    } else {
                        btn.style.cursor = isCompleted ? 'default' : 'not-allowed';
                    }
                    
                    if (isCompleted) {
                        btn.classList.add('completed');
                    } else if (j === i && !isCompleted && !isViewingHistory) {
                        btn.classList.add('next');
                    }
                    
                    const timeDisplay = isCompleted ? record.timeStr : '--:--';
                    const amountValue = record ? record.amount : item.amount;
                    const inputDisabled = isCompleted || isViewingHistory ? 'disabled' : '';
                    
                    btn.innerHTML = `
                        <div class="item-icon">${item.icon}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-time" id="time-${item.id}">${timeDisplay}</div>
                        <input type="text" class="item-amount-input" id="amount-${item.id}" value="${amountValue}" ${inputDisabled} onclick="event.stopPropagation()" onchange="updateItemAmountTemp(${item.id}, this.value)">
                    `;
                    
                    row.appendChild(btn);
                }
                
                container.appendChild(row);
            }
        }

        function updateItemAmountTemp(itemId, newAmount) {
            if (isViewingHistory) return;
            
            const item = config.items.find(i => i.id === itemId);
            if (item) {
                item.amount = newAmount;
                const record = records.find(r => r.id === itemId);
                if (record) {
                    record.amount = newAmount;
                }
                showToast('å®¹é‡å·²æ›´æ–°ï¼š' + newAmount);
            }
        }

        function recordItem(id) {
            if (isViewingHistory) return;
            
            const item = config.items.find(i => i.id === id);
            const existing = records.find(r => r.id === id);
            if (existing && existing.completed) return;
            
            const now = new Date();
            
            if (timeLimitEnabled) {
                const check = checkTimeConstraints(item, now);
                if (!check.canProceed) {
                    showToast(check.message);
                    return;
                }
            }
            
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            const amountInput = document.getElementById(`amount-${id}`);
            const currentAmount = amountInput ? amountInput.value : item.amount;
            
            const recordIndex = records.findIndex(r => r.id === id);
            if (recordIndex >= 0) {
                records[recordIndex] = { id, completed: true, time: now, timeStr: timeStr, amount: currentAmount };
            } else {
                records.push({ id, completed: true, time: now, timeStr: timeStr, amount: currentAmount });
            }
            
            const btn = document.getElementById(`item-${id}`);
            btn.classList.add('completed');
            btn.classList.remove('next', 'disabled', 'warning', 'urgent');
            
            const timeEl = document.getElementById(`time-${id}`);
            timeEl.textContent = timeStr;
            
            if (amountInput) {
                amountInput.disabled = true;
            }
            
            const badge = btn.querySelector('.wait-badge');
            const urgent = btn.querySelector('.urgent-text');
            if (badge) badge.remove();
            if (urgent) urgent.remove();
            
            updateStats();
            highlightNext();
            checkAllComplete();
        }

        function checkTimeConstraints(item, now) {
            if (item.interval > 0) {
                const lastRecord = records
                    .filter(r => r.completed && r.id !== item.id)
                    .sort((a, b) => b.time - a.time)[0];
                
                if (lastRecord) {
                    const minutesDiff = Math.floor((now - lastRecord.time) / (1000 * 60));
                    if (minutesDiff < item.interval) {
                        return {
                            canProceed: false,
                            message: `éœ€ç­‰å¾… ${item.interval - minutesDiff} åˆ†é’Ÿ`
                        };
                    }
                }
            }
            
            if (item.specialInterval) {
                const specialRecords = records.filter(r => {
                    const configItem = config.items.find(i => i.id === r.id);
                    return r.completed && configItem && configItem.type === item.specialInterval.type;
                }).sort((a, b) => b.time - a.time);
                
                if (specialRecords.length > 0) {
                    const minutesDiff = Math.floor((now - specialRecords[0].time) / (1000 * 60));
                    if (minutesDiff < item.specialInterval.minutes) {
                        const typeName = item.specialInterval.type === 'milk' ? 'å–‚å¥¶' : 'åƒè¯';
                        return {
                            canProceed: false,
                            message: `${typeName}åéœ€é—´éš”${item.specialInterval.minutes}åˆ†é’Ÿ`
                        };
                    }
                }
            }
            
            for (let other of config.items) {
                if (other.specialInterval && other.specialInterval.type === item.type) {
                    const otherRecord = records.find(r => r.id === other.id && r.completed);
                    if (otherRecord) {
                        const minutesDiff = Math.floor((now - otherRecord.time) / (1000 * 60));
                        if (minutesDiff < other.specialInterval.minutes) {
                            return {
                                canProceed: false,
                                message: `åƒ${other.name}åéœ€é—´éš”${other.specialInterval.minutes}åˆ†é’Ÿ`
                            };
                        }
                    }
                }
            }
            
            return { canProceed: true, message: '' };
        }

        function highlightNext() {
            for (let item of config.items) {
                const record = records.find(r => r.id === item.id);
                if (!record || !record.completed) {
                    const btn = document.getElementById(`item-${item.id}`);
                    if (btn && !btn.classList.contains('completed')) {
                        btn.classList.add('next');
                    }
                    updateButtonStates();
                    return;
                }
            }
        }

        function updateButtonStates() {
            if (!timeLimitEnabled || isViewingHistory) return;
            
            const now = new Date();
            
            for (let item of config.items) {
                const record = records.find(r => r.id === item.id);
                if (record && record.completed) continue;
                
                const btn = document.getElementById(`item-${item.id}`);
                if (!btn) continue;
                
                const check = checkTimeConstraints(item, now);
                
                btn.classList.remove('disabled', 'warning', 'urgent');
                const oldBadge = btn.querySelector('.wait-badge');
                const oldUrgent = btn.querySelector('.urgent-text');
                if (oldBadge) oldBadge.remove();
                if (oldUrgent) oldUrgent.remove();
                
                if (!check.canProceed) {
                    btn.classList.add('disabled');
                    btn.classList.remove('next');
                    
                    const badge = document.createElement('div');
                    badge.className = 'wait-badge';
                    badge.textContent = check.message.replace(/éœ€ç­‰å¾… |åˆ†é’Ÿ/g, '').substring(0, 6);
                    btn.appendChild(badge);
                }
            }
        }

        function updateStats() {
            const milkItems = config.items.filter(i => i.type === 'milk');
            const completedCount = records.filter(r => {
                const item = config.items.find(i => i.id === r.id);
                return r.completed && item && item.type === 'milk';
            }).length;
            
            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('remainingCount').textContent = milkItems.length - completedCount;
            
            let total = 0;
            records.forEach(r => {
                const item = config.items.find(i => i.id === r.id);
                if (r.completed && item && item.type === 'milk') {
                    const match = r.amount.match(/(\d+)/);
                    if (match) total += parseInt(match[1]);
                }
            });
            document.getElementById('totalAmount').textContent = total;
        }

        function checkAllComplete() {
            const allCompleted = config.items.every(item => {
                const record = records.find(r => r.id === item.id);
                return record && record.completed;
            });
            
            if (allCompleted) {
                clearInterval(checkInterval);
                createConfetti();
                setTimeout(() => {
                    document.getElementById('celebrationOverlay').classList.add('show');
                }, 300);
            }
        }

        function createConfetti() {
            const colors = ['#FF8FA3', '#6BCBFF', '#FFD93D', '#7AE582', '#C084FC', '#FFCC80'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function recordPoop(type) {
            if (isViewingHistory) {
                showToast('å†å²è®°å½•ä¸èƒ½ä¿®æ”¹');
                return;
            }
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
            
            poopRecords[type]++;
            poopRecords.times.push({ type, time: timeStr });
            
            updatePoopDisplay();
            
            const label = config.poopLabels[type];
            showToast(`å·²è®°å½•${label}`);
        }

        function updatePoopDisplay() {
            document.getElementById('poopNormal').textContent = poopRecords.normal;
            document.getElementById('poopDiarrhea').textContent = poopRecords.diarrhea;
            document.getElementById('poopHard').textContent = poopRecords.hard;
            
            const poopList = document.getElementById('poopList');
            poopList.innerHTML = '';
            poopRecords.times.forEach(record => {
                const label = config.poopLabels[record.type];
                const poopItem = document.createElement('span');
                poopItem.className = 'poop-item';
                poopItem.textContent = `${record.time} ${label}`;
                poopList.appendChild(poopItem);
            });
        }

        // å†å²è®°å½•åŠŸèƒ½
        function openHistory() {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            const dates = Object.keys(allData).sort((a, b) => new Date(b) - new Date(a));
            
            if (dates.length === 0) {
                historyList.innerHTML = '<div class="history-empty">æš‚æ— å†å²è®°å½•</div>';
            } else {
                dates.forEach(dateStr => {
                    const dayData = allData[dateStr];
                    const date = new Date(dateStr);
                    
                    // å¤„ç†å¤šä¸ªè®°å½•çš„æƒ…å†µ
                    let recordsList;
                    if (Array.isArray(dayData)) {
                        recordsList = dayData;
                    } else {
                        recordsList = [dayData];
                    }
                    
                    recordsList.forEach((record, index) => {
                        const recordsToShow = record.records;
                        const poopToShow = record.poopRecords;
                        const savedTime = new Date(record.savedAt);
                        
                        // è®¡ç®—ç»Ÿè®¡æ•°æ®
                        const milkCount = recordsToShow.filter(r => {
                            const item = config.items.find(i => i.id === r.id);
                            return r.completed && item && item.type === 'milk';
                        }).length;
                        
                        let totalMl = 0;
                        recordsToShow.forEach(r => {
                            const item = config.items.find(i => i.id === r.id);
                            if (r.completed && item && item.type === 'milk') {
                                const match = r.amount.match(/(\d+)/);
                                if (match) totalMl += parseInt(match[1]);
                            }
                        });
                        
                        const poopTotal = poopToShow.normal + poopToShow.diarrhea + poopToShow.hard;
                        
                        const today = new Date().toDateString();
                        const isToday = dateStr === today;
                        
                        const item = document.createElement('div');
                        item.className = 'history-item' + (isToday && index === recordsList.length - 1 ? ' active' : '');
                        
                        let dateText;
                        if (isToday) {
                            dateText = 'ä»Šå¤©';
                        } else {
                            dateText = date.toLocaleDateString('zh-CN', {
                                month: 'long',
                                day: 'numeric',
                                weekday: 'short'
                            });
                        }
                        
                        const timeStr = savedTime.toLocaleTimeString('zh-CN', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        item.innerHTML = `
                            <button class="history-delete" onclick="event.stopPropagation(); deleteHistoryItem('${dateStr}', ${index})" title="åˆ é™¤æ­¤è®°å½•">Ã—</button>
                            <div class="history-date">${dateText} ${isToday && index === recordsList.length - 1 ? 'ğŸ‘ˆ' : ''}</div>
                            <div class="history-time">ğŸ• ${timeStr}</div>
                            <div class="history-stats">
                                <span class="history-stat">å–å¥¶ ${milkCount} æ¬¡</span>
                                <span class="history-stat">æ€»é‡ ${totalMl}ml</span>
                                <span class="history-stat">å¤§ä¾¿ ${poopTotal} æ¬¡</span>
                            </div>
                        `;
                        
                        // ç‚¹å‡»å¡ç‰‡æŸ¥çœ‹è¯¦æƒ…ï¼ˆä¸åŒ…æ‹¬åˆ é™¤æŒ‰é’®ï¼‰
                        item.onclick = (e) => {
                            if (!e.target.classList.contains('history-delete')) {
                                selectDate(dateStr, index);
                            }
                        };
                        
                        historyList.appendChild(item);
                    });
                });
            }
            
            document.getElementById('historyModal').classList.add('show');
        }

        // åˆ é™¤å†å²è®°å½•é¡¹
        function deleteHistoryItem(dateStr, recordIndex) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                return;
            }
            
            if (deleteHistoryRecord(dateStr, recordIndex)) {
                showToast('ğŸ—‘ï¸ è®°å½•å·²åˆ é™¤');
                // åˆ·æ–°å†å²åˆ—è¡¨
                openHistory();
                
                // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰æŸ¥çœ‹çš„è®°å½•ï¼Œå›åˆ°ä»Šå¤©
                if (currentDate === dateStr) {
                    const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                    if (!allData[dateStr]) {
                        backToToday();
                    }
                }
            } else {
                showToast('âŒ åˆ é™¤å¤±è´¥');
            }
        }

        function closeHistory() {
            document.getElementById('historyModal').classList.remove('show');
        }

        function selectDate(dateStr, recordIndex = 0) {
            closeHistory();
            
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const dayData = allData[dateStr];
            
            if (dayData) {
                let selectedRecord;
                if (Array.isArray(dayData)) {
                    selectedRecord = dayData[recordIndex] || dayData[dayData.length - 1];
                } else {
                    selectedRecord = dayData;
                }
                
                records = selectedRecord.records || [];
                poopRecords = selectedRecord.poopRecords || { normal: 0, diarrhea: 0, hard: 0, times: [] };
                timeLimitEnabled = selectedRecord.timeLimitEnabled !== undefined ? selectedRecord.timeLimitEnabled : true;
            }
            
            currentDate = dateStr;
            updateDateDisplay();
            startDay();
            
            const today = new Date().toDateString();
            if (currentDate !== today) {
                showToast('æ­£åœ¨æŸ¥çœ‹å†å²è®°å½•');
            }
        }

        function backToToday() {
            closeHistory();
            loadTodayData();
            startDay();
            showToast('å›åˆ°ä»Šå¤©');
        }

        // é…ç½®ç›¸å…³
        function openConfig() {
            document.getElementById('titleInput').value = config.title;
            document.getElementById('poopInputNormal').value = config.poopLabels.normal;
            document.getElementById('poopInputDiarrhea').value = config.poopLabels.diarrhea;
            document.getElementById('poopInputHard').value = config.poopLabels.hard;
            
            renderSortableList();
            document.getElementById('configModal').classList.add('show');
        }

        function closeConfig() {
            document.getElementById('configModal').classList.remove('show');
            hideAddForm();
        }

        function updateTitle() {
            const newTitle = document.getElementById('titleInput').value.trim();
            if (newTitle) {
                config.title = newTitle;
                document.getElementById('titleText').textContent = newTitle;
                showToast('æ ‡é¢˜å·²ä¿®æ”¹ï¼š' + newTitle);
                saveConfig();
            }
        }

        // ä¿®å¤åçš„æ‹–åŠ¨æ’åºåŠŸèƒ½
        function renderSortableList() {
            const container = document.getElementById('sortableItems');
            container.innerHTML = '';
            
            config.items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'sortable-item';
                div.draggable = true;
                div.dataset.index = index;
                
                div.innerHTML = `
                    <div class="drag-handle">â˜°</div>
                    <button class="sortable-delete" onclick="event.stopPropagation(); removeItem(${index})">Ã—</button>
                    <div class="sortable-content">
                        <div class="sortable-header">
                            <span class="sortable-name">${item.icon} ${item.name}</span>
                            <span class="sortable-type type-tag-${item.type}">${getTypeLabel(item.type)}</span>
                        </div>
                        <div class="sortable-settings">
                            <div class="sortable-setting">
                                <label>å‰‚é‡</label>
                                <input type="text" value="${item.amount}" onchange="updateItemAmount(${index}, this.value)">
                            </div>
                            <div class="sortable-setting">
                                <label>é—´éš”</label>
                                <select onchange="updateItemInterval(${index}, this.value)">
                                    <option value="0" ${item.interval === 0 ? 'selected' : ''}>æ— </option>
                                    <option value="30" ${item.interval === 30 ? 'selected' : ''}>30åˆ†</option>
                                    <option value="60" ${item.interval === 60 ? 'selected' : ''}>1å°æ—¶</option>
                                    <option value="120" ${item.interval === 120 ? 'selected' : ''}>2å°æ—¶</option>
                                </select>
                            </div>
                        </div>
                    </div>
                `;
                
                // é¼ æ ‡æ‹–æ‹½äº‹ä»¶
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragend', handleDragEnd);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragenter', handleDragEnter);
                div.addEventListener('dragleave', handleDragLeave);
                
                // è§¦æ‘¸å±æ‹–æ‹½äº‹ä»¶
                const handle = div.querySelector('.drag-handle');
                handle.addEventListener('touchstart', handleTouchStart, {passive: false});
                handle.addEventListener('touchmove', handleTouchMove, {passive: false});
                handle.addEventListener('touchend', handleTouchEnd);
                
                container.appendChild(div);
            });
        }

        // é¼ æ ‡æ‹–æ‹½å˜é‡
        let dragSrcEl = null;

        function handleDragStart(e) {
            dragSrcEl = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }

        function handleDragOver(e) {
            if (e.preventDefault) {
                e.preventDefault();
            }
            e.dataTransfer.dropEffect = 'move';
            return false;
        }

        function handleDragEnter(e) {
            if (this !== dragSrcEl) {
                this.classList.add('drag-over');
            }
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            if (e.stopPropagation) {
                e.stopPropagation();
            }
            
            if (dragSrcEl !== this) {
                const container = document.getElementById('sortableItems');
                const children = Array.from(container.children);
                const srcIndex = children.indexOf(dragSrcEl);
                const targetIndex = children.indexOf(this);
                
                // äº¤æ¢æ•°æ®
                const temp = config.items[srcIndex];
                config.items[srcIndex] = config.items[targetIndex];
                config.items[targetIndex] = temp;
                
                // é‡æ–°æ¸²æŸ“
                renderSortableList();
            }
            
            return false;
        }

        function handleDragEnd(e) {
            this.classList.remove('dragging');
            document.querySelectorAll('.sortable-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        // è§¦æ‘¸å±æ‹–æ‹½å˜é‡
        let touchDragItem = null;
        let touchStartY = 0;
        let touchCurrentY = 0;

        function handleTouchStart(e) {
            e.preventDefault();
            touchDragItem = this.closest('.sortable-item');
            touchStartY = e.touches[0].clientY;
            touchDragItem.classList.add('dragging');
        }

        function handleTouchMove(e) {
            e.preventDefault();
            if (!touchDragItem) return;
            
            touchCurrentY = e.touches[0].clientY;
            
            const container = document.getElementById('sortableItems');
            const children = Array.from(container.children);
            
            // æ‰¾åˆ°å½“å‰è§¦æ‘¸ä½ç½®ä¸‹çš„å…ƒç´ 
            const touch = e.touches[0];
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            const targetItem = target?.closest('.sortable-item');
            
            if (targetItem && targetItem !== touchDragItem) {
                children.forEach(child => child.classList.remove('drag-over'));
                targetItem.classList.add('drag-over');
            }
        }

        function handleTouchEnd(e) {
            if (!touchDragItem) return;
            
            const touch = e.changedTouches[0];
            const target = document.elementFromPoint(touch.clientX, touch.clientY);
            const targetItem = target?.closest('.sortable-item');
            
            if (targetItem && targetItem !== touchDragItem) {
                const container = document.getElementById('sortableItems');
                const children = Array.from(container.children);
                const srcIndex = children.indexOf(touchDragItem);
                const targetIndex = children.indexOf(targetItem);
                
                // äº¤æ¢æ•°æ®
                const temp = config.items[srcIndex];
                config.items[srcIndex] = config.items[targetIndex];
                config.items[targetIndex] = temp;
                
                // é‡æ–°æ¸²æŸ“
                renderSortableList();
            }
            
            touchDragItem.classList.remove('dragging');
            document.querySelectorAll('.sortable-item').forEach(item => {
                item.classList.remove('drag-over');
            });
            touchDragItem = null;
        }

        function getTypeLabel(type) {
            const labels = { milk: 'ç‰›å¥¶', medicine: 'è¯ç‰©', vitamin: 'ç»´ç”Ÿç´ ', food: 'è¾…é£Ÿ', other: 'å…¶ä»–' };
            return labels[type] || 'å…¶ä»–';
        }

        function updateTypeOptions() {
            const type = document.getElementById('newItemType').value;
            const specialGroup = document.getElementById('specialIntervalGroup');
            specialGroup.style.display = (type === 'medicine' || type === 'vitamin') ? 'block' : 'none';
        }

        function showAddForm() {
            document.getElementById('addForm').classList.remove('hidden');
        }

        function hideAddForm() {
            document.getElementById('addForm').classList.add('hidden');
            document.getElementById('newItemName').value = '';
            document.getElementById('newItemAmount').value = '';
        }

        function addNewItem() {
            const name = document.getElementById('newItemName').value;
            const icon = document.getElementById('newItemIcon').value;
            const type = document.getElementById('newItemType').value;
            const amount = document.getElementById('newItemAmount').value || '1æ¬¡';
            const interval = parseInt(document.getElementById('newItemInterval').value);
            
            if (!name) {
                showToast('è¯·è¾“å…¥é¡¹ç›®åç§°');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                name,
                icon,
                type,
                amount,
                interval
            };
            
            if ((type === 'medicine' || type === 'vitamin') && document.getElementById('specialIntervalGroup').style.display !== 'none') {
                const specialMinutes = parseInt(document.getElementById('newItemSpecialInterval').value) || 30;
                newItem.specialInterval = { type: 'milk', minutes: specialMinutes };
            }
            
            config.items.push(newItem);
            renderSortableList();
            hideAddForm();
            showToast('å·²æ·»åŠ ï¼š' + name);
        }

        function removeItem(index) {
            config.items.splice(index, 1);
            renderSortableList();
        }

        function updateItemAmount(index, value) {
            config.items[index].amount = value;
        }

        function updateItemInterval(index, value) {
            config.items[index].interval = parseInt(value);
        }

        function saveConfig() {
            config.poopLabels.normal = document.getElementById('poopInputNormal').value || 'æ­£å¸¸ä¾¿';
            config.poopLabels.diarrhea = document.getElementById('poopInputDiarrhea').value || 'ç¨€ä¾¿';
            config.poopLabels.hard = document.getElementById('poopInputHard').value || 'ç¡¬ä¾¿';
            
            const milkCount = config.items.filter(i => i.type === 'milk').length;
            if (milkCount === 0) {
                showToast('è‡³å°‘éœ€è¦æ·»åŠ ä¸€ä¸ªç‰›å¥¶é¡¹ç›®');
                return;
            }
            
            config.icon = config.items[0]?.icon || 'âœ¨';
            
            closeConfig();
            saveConfig();
            
            // å¦‚æœä»Šå¤©å·²ç»æœ‰æ•°æ®ï¼Œä¿ç•™ï¼›å¦åˆ™é‡ç½®
            const today = new Date().toDateString();
            if (currentDate !== today) {
                loadTodayData();
            }
            startDay();
            showToast('é…ç½®å·²ä¿å­˜');
        }

        function toggleTimeLimit() {
            if (isViewingHistory) return;
            
            timeLimitEnabled = !timeLimitEnabled;
            const switchEl = document.getElementById('toggleSwitch');
            
            if (timeLimitEnabled) {
                switchEl.classList.add('active');
                showToast('â° æ—¶é—´é™åˆ¶å·²å¼€å¯');
            } else {
                switchEl.classList.remove('active');
                showToast('â° æ—¶é—´é™åˆ¶å·²å…³é—­');
                
                document.querySelectorAll('.item-btn').forEach(btn => {
                    btn.classList.remove('disabled', 'warning');
                    const badge = btn.querySelector('.wait-badge');
                    if (badge) badge.remove();
                });
            }
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function closeCelebration() {
            document.getElementById('celebrationOverlay').classList.remove('show');
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        init();
    </script>

</body>
</html>
