<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÂÆùÂÆùÂÅ•Â∫∑ËÆ∞ÂΩï</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --milk-primary: #FF8FA3;
            --milk-dark: #FF6B85;
            --milk-light: #FFF0F3;
            --medicine-primary: #6BCBFF;
            --medicine-dark: #4AA8FF;
            --medicine-light: #E8F7FF;
            --vitamin-primary: #FFD93D;
            --vitamin-dark: #FFB800;
            --vitamin-light: #FFFBE6;
            --food-primary: #7AE582;
            --food-dark: #5BC45F;
            --food-light: #E8F9E9;
            --other-primary: #C084FC;
            --other-dark: #A855F7;
            --other-light: #F3E8FF;
            --bg-gradient-start: #E0F7FA;
            --bg-gradient-mid: #FCE4EC;
            --bg-gradient-end: #F3E5F5;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-mid) 50%, var(--bg-gradient-end) 100%);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* È°∂ÈÉ®Ê†áÈ¢òÊ†è - ÁéªÁíÉÊãüÊÄÅÊïàÊûú */
        .header {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 12px 15px 15px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            text-align: center;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .date {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
            font-weight: 500;
            letter-spacing: 1px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            border-radius: 12px;
            transition: all 0.2s;
        }

        .date:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
        }

        .date::after {
            content: '‚ñº';
            font-size: 8px;
        }

        .title {
            font-size: 22px;
            font-weight: 800;
            color: #555;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .title .icon {
            font-size: 28px;
            animation: gentle-bounce 2s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-4px) rotate(3deg); }
        }

        /* ÁªüËÆ°Âç°Áâá - Ê∏êÂèòËâ≤ÂΩ© */
        .stats {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 12px;
            padding-top: 10px;
        }

        .stat-item {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 16px;
            border-radius: 20px;
            min-width: 80px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transform: translateY(0);
            transition: transform 0.2s;
        }

        .stat-item:active {
            transform: translateY(2px);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 3px;
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.95;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫ */
        .main {
            flex: 1;
            padding: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            gap: 10px;
        }

        /* È°∂ÈÉ®Â∑•ÂÖ∑Ê†è */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.7);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .time-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .toggle-switch.active {
            background: linear-gradient(135deg, #4CAF50, #45a049);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        .top-actions {
            display: flex;
            gap: 8px;
        }

        .edit-btn, .history-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(102,126,234,0.3);
            transition: all 0.2s;
        }

        .history-btn {
            background: linear-gradient(135deg, #FF8FA3 0%, #FF6B85 100%);
            box-shadow: 0 3px 10px rgba(255, 107, 133, 0.3);
        }

        .edit-btn:active, .history-btn:active {
            transform: scale(0.95);
        }

        /* È°πÁõÆÂÆπÂô® - ÂúÜËßíÂç°Áâá */
        .items-container {
            flex: 1;
            overflow-y: auto;
            background: rgba(255,255,255,0.5);
            border-radius: 20px;
            padding: 10px;
            backdrop-filter: blur(10px);
        }

        .item-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }

        /* ÊåâÈíÆÂü∫Á°ÄÊ†∑Âºè - 3DÊïàÊûú */
        .item-btn {
            border: none;
            border-radius: 18px;
            padding: 8px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            transition: all 0.2s;
            position: relative;
            min-height: 95px;
            box-shadow: 0 6px 0 rgba(0,0,0,0.15), 0 8px 20px rgba(0,0,0,0.1);
        }

        .item-btn:active:not(.disabled) {
            transform: translateY(6px);
            box-shadow: 0 0 0 rgba(0,0,0,0.15), 0 2px 5px rgba(0,0,0,0.1);
        }

        /* ÁâõÂ•∂ - Á≤âËâ≤Ê£âËä±Á≥ñ */
        .type-milk {
            background: linear-gradient(180deg, var(--milk-light) 0%, var(--milk-primary) 100%);
            color: #C2185B;
        }
        .type-milk .item-icon { filter: drop-shadow(0 2px 3px rgba(194, 24, 89, 0.2)); }
        .type-milk.next {
            animation: pulse-milk 2s infinite;
            box-shadow: 0 6px 0 var(--milk-dark), 0 8px 25px rgba(255, 107, 133, 0.4);
        }
        @keyframes pulse-milk {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--milk-dark), 0 8px 25px rgba(255, 107, 133, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--milk-dark), 0 12px 30px rgba(255, 107, 133, 0.6); }
        }

        /* ËçØÁâ© - Ê∏ÖÊñ∞Ëìù */
        .type-medicine {
            background: linear-gradient(180deg, var(--medicine-light) 0%, var(--medicine-primary) 100%);
            color: #1565C0;
        }
        .type-medicine .item-icon { filter: drop-shadow(0 2px 3px rgba(21, 101, 192, 0.2)); }
        .type-medicine.next {
            animation: pulse-medicine 2s infinite;
            box-shadow: 0 6px 0 var(--medicine-dark), 0 8px 25px rgba(74, 168, 255, 0.4);
        }
        @keyframes pulse-medicine {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--medicine-dark), 0 8px 25px rgba(74, 168, 255, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--medicine-dark), 0 12px 30px rgba(74, 168, 255, 0.6); }
        }

        /* Áª¥ÁîüÁ¥† - Èò≥ÂÖâÈªÑ */
        .type-vitamin {
            background: linear-gradient(180deg, var(--vitamin-light) 0%, var(--vitamin-primary) 100%);
            color: #E65100;
        }
        .type-vitamin .item-icon { filter: drop-shadow(0 2px 3px rgba(230, 81, 0, 0.2)); }
        .type-vitamin.next {
            animation: pulse-vitamin 2s infinite;
            box-shadow: 0 6px 0 var(--vitamin-dark), 0 8px 25px rgba(255, 184, 0, 0.4);
        }
        @keyframes pulse-vitamin {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--vitamin-dark), 0 8px 25px rgba(255, 184, 0, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--vitamin-dark), 0 12px 30px rgba(255, 184, 0, 0.6); }
        }

        /* ËæÖÈ£ü - Ê∏ÖÊñ∞Áªø */
        .type-food {
            background: linear-gradient(180deg, var(--food-light) 0%, var(--food-primary) 100%);
            color: #2E7D32;
        }
        .type-food .item-icon { filter: drop-shadow(0 2px 3px rgba(46, 125, 50, 0.2)); }
        .type-food.next {
            animation: pulse-food 2s infinite;
            box-shadow: 0 6px 0 var(--food-dark), 0 8px 25px rgba(91, 196, 95, 0.4);
        }
        @keyframes pulse-food {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--food-dark), 0 8px 25px rgba(91, 196, 95, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--food-dark), 0 12px 30px rgba(91, 196, 95, 0.6); }
        }

        /* ÂÖ∂‰ªñ - Ê¢¶ÂπªÁ¥´ */
        .type-other {
            background: linear-gradient(180deg, var(--other-light) 0%, var(--other-primary) 100%);
            color: #7B1FA2;
        }
        .type-other .item-icon { filter: drop-shadow(0 2px 3px rgba(123, 31, 162, 0.2)); }
        .type-other.next {
            animation: pulse-other 2s infinite;
            box-shadow: 0 6px 0 var(--other-dark), 0 8px 25px rgba(168, 85, 247, 0.4);
        }
        @keyframes pulse-other {
            0%, 100% { transform: translateY(0); box-shadow: 0 6px 0 var(--other-dark), 0 8px 25px rgba(168, 85, 247, 0.4); }
            50% { transform: translateY(-3px); box-shadow: 0 9px 0 var(--other-dark), 0 12px 30px rgba(168, 85, 247, 0.6); }
        }

        /* ÂÆåÊàêÁä∂ÊÄÅ - Áªü‰∏ÄÁªøËâ≤ */
        .item-btn.completed {
            background: linear-gradient(180deg, #E8F5E9 0%, #81C784 100%) !important;
            color: #1B5E20 !important;
            box-shadow: 0 2px 0 #4CAF50, 0 4px 10px rgba(76, 175, 80, 0.3) !important;
            transform: translateY(4px);
        }

        .item-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: -6px;
            right: -6px;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid white;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
            animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop-in {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        /* Á¶ÅÁî®Áä∂ÊÄÅ */
        .item-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(0.6) brightness(0.9);
            box-shadow: 0 2px 0 rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.1) !important;
            transform: translateY(4px);
        }

        /* Ë≠¶ÂëäÁä∂ÊÄÅ */
        .item-btn.warning {
            animation: shake 0.5s ease-in-out infinite;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-3px) translateY(0); }
            75% { transform: translateX(3px) translateY(0); }
        }

        /* Á¥ßÊÄ•Áä∂ÊÄÅ */
        .item-btn.urgent {
            animation: urgent-pulse 0.8s infinite;
        }
        @keyframes urgent-pulse {
            0%, 100% { transform: scale(1) translateY(0); box-shadow: 0 6px 0 #d32f2f, 0 8px 20px rgba(211, 47, 47, 0.4); }
            50% { transform: scale(1.03) translateY(-2px); box-shadow: 0 8px 0 #d32f2f, 0 12px 30px rgba(211, 47, 47, 0.6); }
        }

        /* ÊåâÈíÆÂÜÖÂÆπ - Êó∂Èó¥ÂíåÂÆπÈáè‰ΩçÁΩÆ‰∫íÊç¢ */
        .item-icon {
            font-size: 24px;
            line-height: 1;
        }

        .item-name {
            font-size: 14px;
            font-weight: 700;
            color: inherit;
            text-align: center;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(255,255,255,0.4);
            max-width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            backdrop-filter: blur(4px);
        }

        /* ÂÆπÈáèËæìÂÖ•Ê°Ü */
        .item-amount-input {
            font-size: 12px;
            color: inherit;
            background: rgba(255,255,255,0.6);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 3px 6px;
            border-radius: 8px;
            width: 90%;
            text-align: center;
            font-weight: 600;
            outline: none;
        }

        .item-amount-input:focus {
            background: rgba(255,255,255,0.9);
            border-color: rgba(255,255,255,0.8);
        }

        .item-btn.completed .item-amount-input {
            background: rgba(255,255,255,0.4);
            border-color: transparent;
            color: #1B5E20;
        }

        .item-time {
            font-size: 11px;
            font-weight: 700;
            color: inherit;
            background: rgba(255,255,255,0.5);
            padding: 3px 10px;
            border-radius: 12px;
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .item-btn.completed .item-time {
            background: rgba(255,255,255,0.6);
            color: #1B5E20;
        }

        /* Á≠âÂæÖÊ†áÁ≠æ */
        .wait-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
            white-space: nowrap;
            box-shadow: 0 3px 10px rgba(238, 90, 111, 0.4);
            z-index: 5;
            border: 2px solid white;
            animation: badge-bounce 1s infinite;
        }

        @keyframes badge-bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }

        .urgent-text {
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #d32f2f, #c62828);
            color: white;
            font-size: 9px;
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: 700;
            animation: blink 0.6s infinite;
            box-shadow: 0 2px 8px rgba(211, 47, 47, 0.4);
            border: 1px solid rgba(255,255,255,0.3);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Â§ß‰æøËÆ∞ÂΩïÂå∫ - ÊîæÂú®ÊúÄÂ∫ïÈÉ®ÔºåÊåâÈíÆÊõ¥ÁüÆ‰ΩÜÊñáÂ≠óÊ≠£Â∏∏Â§ßÂ∞è */
        .poop-section {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 10px 12px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 1px solid rgba(255,255,255,0.6);
            margin-top: auto;
            order: 999;
        }

        .poop-title {
            font-size: 13px;
            color: #8D6E63;
            text-align: center;
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .poop-title::before,
        .poop-title::after {
            content: '‚Ä¢';
            color: #BCAAA4;
        }

        .poop-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
        }

        .poop-btn {
            flex: 1;
            background: linear-gradient(180deg, #FFF8E1 0%, #FFCC80 100%);
            border: none;
            border-radius: 10px;
            padding: 4px 4px;
            cursor: pointer;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 2px 0 #FF9800, 0 3px 8px rgba(255, 152, 0, 0.2);
            transition: all 0.2s;
            color: #E65100;
            position: relative;
            overflow: hidden;
            height: 28px;
        }

        .poop-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255,255,255,0.4) 0%, transparent 100%);
            pointer-events: none;
        }

        .poop-btn:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #FF9800, 0 2px 5px rgba(255, 152, 0, 0.2);
        }

        .poop-btn .icon {
            font-size: 16px;
            filter: drop-shadow(0 1px 2px rgba(0,0,0,0.1));
        }

        .poop-btn .label {
            font-size: 14px;
            font-weight: 700;
        }

        .poop-btn .count {
            font-size: 12px;
            background: rgba(255,255,255,0.6);
            padding: 2px 8px;
            border-radius: 10px;
            min-width: 20px;
            font-weight: 700;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .poop-list {
            max-height: 60px;
            overflow-y: auto;
            font-size: 11px;
            color: #8D6E63;
            text-align: center;
            padding: 6px;
            background: rgba(255,255,255,0.5);
            border-radius: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }

        .poop-list:empty {
            display: none;
        }

        .poop-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: linear-gradient(135deg, #D7CCC8, #BCAAA4);
            color: #5D4037;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Â∫ïÈÉ®ÊåâÈíÆÁªÑ - ‰øùÂ≠òÂíåÈáçÁΩÆÂàÜÂºÄ */
        .bottom-actions {
            display: flex;
            gap: 10px;
            margin-top: 4px;
            order: 1000;
        }

        .save-btn, .reset-btn {
            flex: 1;
            border: none;
            padding: 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .save-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 0 #5a67d8, 0 6px 15px rgba(102, 126, 234, 0.3);
        }

        .save-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #5a67d8, 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .reset-btn {
            background: linear-gradient(135deg, #FFE0B2 0%, #FFCC80 100%);
            color: #E65100;
            box-shadow: 0 4px 0 #FF9800, 0 6px 15px rgba(255, 152, 0, 0.2);
        }

        .reset-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #FF9800, 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .config-modal, .history-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .config-modal.show, .history-modal.show {
            display: flex;
        }

        .config-content, .history-content {
            background: white;
            border-radius: 25px;
            width: 100%;
            max-width: 400px;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.3);
            animation: slide-up 0.3s ease;
            overflow: hidden;
        }

        @keyframes slide-up {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .config-header, .history-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }

        .history-header {
            background: linear-gradient(135deg, #FF8FA3 0%, #FF6B85 100%);
        }

        .config-header h2, .history-header h2 {
            font-size: 20px;
            font-weight: 700;
            margin: 0;
        }

        .config-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #F5F7FA;
        }

        /* ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®Ê†∑Âºè */
        .history-list {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #F5F7FA;
        }

        .history-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 2px solid transparent;
            position: relative;
        }

        .history-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-item.active {
            border-color: #667eea;
            background: #F0F4FF;
        }

        .history-date {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-date::before {
            content: 'üìÖ';
        }

        .history-time {
            font-size: 12px;
            color: #888;
            margin-bottom: 8px;
            padding-left: 28px;
        }

        .history-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
        }

        .history-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .history-stat::before {
            content: '‚Ä¢';
            color: #999;
        }

        /* Âà†Èô§ÊåâÈíÆ */
        .history-delete {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(238, 90, 111, 0.3);
            transition: all 0.2s;
            z-index: 10;
        }

        .history-delete:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(238, 90, 111, 0.4);
        }

        .history-delete:active {
            transform: scale(0.95);
        }

        .history-empty {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 14px;
        }

        .history-empty::before {
            content: 'üì≠';
            display: block;
            font-size: 48px;
            margin-bottom: 10px;
        }

        .title-edit {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 12px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .title-edit input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .title-edit input:focus {
            outline: none;
            border-color: #667eea;
        }

        .title-edit button {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }

        .poop-config {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .poop-config-title {
            font-size: 14px;
            color: #555;
            margin-bottom: 12px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .poop-config-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .poop-config-item span {
            font-size: 20px;
        }

        .poop-config-item input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .poop-config-item input:focus {
            outline: none;
            border-color: #FF9800;
        }

        .drag-hint {
            text-align: center;
            font-size: 12px;
            color: #667eea;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            font-weight: 500;
            border: 2px dashed rgba(102, 126, 234, 0.3);
        }

        .sortable-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 12px;
            position: relative;
            touch-action: none;
            user-select: none;
            border: 2px solid transparent;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: move;
        }

        .sortable-item.dragging {
            opacity: 0.6;
            border-color: #667eea;
            transform: scale(1.02) rotate(2deg);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            z-index: 1000;
        }

        .sortable-item.drag-over {
            border-top: 3px solid #667eea;
            transform: translateY(5px);
        }

        .drag-handle {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #BBB;
            font-size: 20px;
            cursor: grab;
            padding: 5px;
            touch-action: none;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .sortable-content {
            margin-left: 35px;
            margin-right: 40px;
        }

        .sortable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sortable-name {
            font-weight: 700;
            color: #333;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .sortable-type {
            font-size: 11px;
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 600;
            flex-shrink: 0;
        }

        .type-tag-milk { background: linear-gradient(135deg, #FF8FA3, #FF6B85); }
        .type-tag-medicine { background: linear-gradient(135deg, #6BCBFF, #4AA8FF); }
        .type-tag-vitamin { background: linear-gradient(135deg, #FFD93D, #FFB800); color: #333; }
        .type-tag-food { background: linear-gradient(135deg, #7AE582, #5BC45F); }
        .type-tag-other { background: linear-gradient(135deg, #C084FC, #A855F7); }

        .sortable-settings {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 12px;
            color: #666;
        }

        .sortable-setting {
            background: #F5F7FA;
            padding: 10px;
            border-radius: 10px;
        }

        .sortable-setting label {
            display: block;
            font-size: 10px;
            color: #999;
            margin-bottom: 5px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .sortable-setting input, .sortable-setting select {
            width: 100%;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
            padding: 8px;
            font-size: 13px;
            transition: border-color 0.2s;
            background: white;
        }

        .sortable-setting input:focus, .sortable-setting select:focus {
            outline: none;
            border-color: #667eea;
        }

        .sortable-delete {
            position: absolute;
            top: 50%;
            right: 12px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #FF6B6B, #EE5A6F);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(238, 90, 111, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .sortable-delete:active {
            transform: translateY(-50%) scale(0.9);
        }

        .config-add-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .config-add-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .add-item-form {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            border: 2px solid #667eea;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            color: #555;
            margin-bottom: 6px;
            font-weight: 600;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s;
            background: white;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .config-actions {
            padding: 20px;
            background: white;
            border-top: 1px solid #EEE;
            display: flex;
            gap: 12px;
        }

        .config-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-size: 15px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.2s;
        }

        .config-btn.cancel {
            background: #F5F7FA;
            color: #666;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .config-btn.cancel:active {
            background: #E0E0E0;
        }

        .config-btn.save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .config-btn.save:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        /* Toast ÊèêÁ§∫ */
        .toast {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(51, 51, 51, 0.95);
            color: white;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 14px;
            font-weight: 600;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 300;
            white-space: nowrap;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Â∫ÜÁ•ùÂºπÁ™ó */
        .celebration-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(8px);
            z-index: 250;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .celebration-overlay.show {
            display: flex;
        }

        .celebration {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 30px 80px rgba(0,0,0,0.3);
            animation: celebration-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-width: 300px;
            width: 90%;
        }

        @keyframes celebration-pop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .celebration-icon {
            font-size: 70px;
            margin-bottom: 15px;
            animation: celebration-bounce 1s ease infinite;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.1));
        }

        @keyframes celebration-bounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }

        .celebration h2 {
            font-size: 26px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 800;
        }

        .celebration p {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .confetti {
            position: fixed;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            animation: confetti-fall 3s ease-out forwards;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        @keyframes confetti-fall {
            0% { 
                transform: translateY(-20px) rotate(0deg) scale(1); 
                opacity: 1; 
            }
            100% { 
                transform: translateY(100vh) rotate(720deg) scale(0.5); 
                opacity: 0; 
            }
        }

        .hidden {
            display: none !important;
        }

        /* ÊªöÂä®Êù°ÁæéÂåñ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0,0,0,0.3);
        }

        /* ÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-height: 700px) {
            .item-btn {
                min-height: 85px;
                padding: 6px 4px;
            }
            .item-icon {
                font-size: 22px;
            }
        }

        @media (min-height: 800px) {
            .item-row {
                margin-bottom: 12px;
            }
            .item-btn {
                min-height: 105px;
            }
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="date" id="currentDate" onclick="openHistory()">1Êúà1Êó•</div>
        <div class="title"><span class="icon" id="titleIcon">üçº</span> <span id="titleText">ÂÆùÂÆùÂñÇÂ•∂ËÆ∞ÂΩï</span></div>
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="completedCount">0</div>
                <div class="stat-label" id="completedLabel">ÂñùÂ•∂ÂÆåÊàê</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="remainingCount">0</div>
                <div class="stat-label" id="remainingLabel">ÂñùÂ•∂Ââ©‰Ωô</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalAmount">0</div>
                <div class="stat-label" id="amountLabel">Â•∂Èáè(ml)</div>
            </div>
        </div>
    </div>

    <div class="main">
        <!-- Áõ¥Êé•ËøõÂÖ•‰∏ªÁïåÈù¢ÔºåÊ≤°ÊúâÂºÄÂßãÈ°µÈù¢ -->
        <div class="top-bar" id="topBar">
            <div class="time-toggle">
                <span>‚è∞ Êó∂Èó¥ÈôêÂà∂</span>
                <div class="toggle-switch active" id="toggleSwitch" onclick="toggleTimeLimit()"></div>
            </div>
            <div class="top-actions">
                <button class="history-btn" onclick="openHistory()">üìÖ ÂéÜÂè≤</button>
                <button class="edit-btn" onclick="openConfig()">‚öôÔ∏è ËÆæÁΩÆ</button>
            </div>
        </div>

        <div class="items-container" id="itemsContainer"></div>

        <!-- Â§ß‰æøËÆ∞ÂΩïÊîæÂú®ÊúÄÂ∫ïÈÉ® -->
        <div class="poop-section" id="poopSection">
            <div class="poop-title">üí© Â§ß‰æøËÆ∞ÂΩï</div>
            <div class="poop-buttons">
                <button class="poop-btn" onclick="recordPoop('normal')">
                    <span class="icon">üí©</span>
                    <span class="label" id="poopLabelNormal">Ê≠£Â∏∏‰æø</span>
                    <span class="count" id="poopNormal">0</span>
                </button>
                <button class="poop-btn" onclick="recordPoop('diarrhea')">
                    <span class="icon">üíß</span>
                    <span class="label" id="poopLabelDiarrhea">Á®Ä‰æø</span>
                    <span class="count" id="poopDiarrhea">0</span>
                </button>
                <button class="poop-btn" onclick="recordPoop('hard')">
                    <span class="icon">üç´</span>
                    <span class="label" id="poopLabelHard">Á°¨‰æø</span>
                    <span class="count" id="poopHard">0</span>
                </button>
            </div>
            <div class="poop-list" id="poopList"></div>
        </div>

        <!-- Â∫ïÈÉ®ÊåâÈíÆÁªÑÔºö‰øùÂ≠òÂíåÈáçÁΩÆÂàÜÂºÄ -->
        <div class="bottom-actions">
            <button class="save-btn" id="saveBtn" onclick="saveDayRecord()">
                <span>üíæ</span> ‰øùÂ≠òËÆ∞ÂΩï
            </button>
            <button class="reset-btn" id="resetBtn" onclick="resetCurrentDay()">
                <span>üîÑ</span> ÂºÄÂßãÊñ∞ËÆ∞ÂΩï
            </button>
        </div>
    </div>

    <!-- ÈÖçÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div class="config-modal" id="configModal">
        <div class="config-content">
            <div class="config-header">
                <h2>‚öôÔ∏è Ëá™ÂÆö‰πâÈÖçÁΩÆ</h2>
            </div>
            
            <div class="config-list" id="configList">
                <div class="title-edit">
                    <input type="text" id="titleInput" placeholder="ËæìÂÖ•Ê†áÈ¢ò" value="ÂÆùÂÆùÂñÇÂ•∂ËÆ∞ÂΩï">
                    <button onclick="updateTitle()">‰øÆÊîπ</button>
                </div>

                <div class="poop-config">
                    <div class="poop-config-title">üí© Â§ß‰æøÊåâÈíÆÊñáÂ≠ó</div>
                    <div class="poop-config-item">
                        <span>üí©</span>
                        <input type="text" id="poopInputNormal" value="Ê≠£Â∏∏‰æø" placeholder="ÊåâÈíÆÊñáÂ≠ó">
                    </div>
                    <div class="poop-config-item">
                        <span>üíß</span>
                        <input type="text" id="poopInputDiarrhea" value="Á®Ä‰æø" placeholder="ÊåâÈíÆÊñáÂ≠ó">
                    </div>
                    <div class="poop-config-item">
                        <span>üç´</span>
                        <input type="text" id="poopInputHard" value="Á°¨‰æø" placeholder="ÊåâÈíÆÊñáÂ≠ó">
                    </div>
                </div>

                <div class="drag-hint">üëÜ Êåâ‰Ωè ‚ò∞ ÊãñÂä®ÊéíÂ∫èÔºåÂñùÂ•∂ÁºñÂè∑‰ºöËá™Âä®Êõ¥Êñ∞</div>
                <div id="sortableItems"></div>
                <button class="config-add-btn" onclick="showAddForm()">+ Ê∑ªÂä†È°πÁõÆ</button>
                
                <div class="add-item-form hidden" id="addForm">
                    <div class="form-group">
                        <label>È°πÁõÆÂêçÁß∞</label>
                        <input type="text" id="newItemName" placeholder="Â¶ÇÔºöÂñùÁâõÂ•∂„ÄÅÂêÉËçØ">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ÂõæÊ†á</label>
                            <select id="newItemIcon">
                                <option value="ü•õ">ü•õ ÁâõÂ•∂</option>
                                <option value="üíä">üíä ËçØ</option>
                                <option value="‚òÄÔ∏è">‚òÄÔ∏è Áª¥D</option>
                                <option value="üçö">üçö ËæÖÈ£ü</option>
                                <option value="üíß">üíß Ê∞¥</option>
                                <option value="üçº">üçº Â•∂Áì∂</option>
                                <option value="ü•Ñ">ü•Ñ Âã∫Â≠ê</option>
                                <option value="‚ú®">‚ú® ÂÖ∂‰ªñ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Á±ªÂûã</label>
                            <select id="newItemType" onchange="updateTypeOptions()">
                                <option value="milk">ÁâõÂ•∂ÔºàÂèÇ‰∏éÁºñÂè∑ÁªüËÆ°Ôºâ</option>
                                <option value="medicine">ËçØÁâ©</option>
                                <option value="vitamin">Áª¥ÁîüÁ¥†</option>
                                <option value="food">ËæÖÈ£ü</option>
                                <option value="other">ÂÖ∂‰ªñ</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ÂâÇÈáè/Êï∞Èáè</label>
                            <input type="text" id="newItemAmount" placeholder="Â¶ÇÔºö300ml">
                        </div>
                        <div class="form-group">
                            <label>‰∏é‰∏äÊ¨°Èó¥Èöî</label>
                            <select id="newItemInterval">
                                <option value="0">Êó†ÈôêÂà∂</option>
                                <option value="30">30ÂàÜÈíü</option>
                                <option value="60" selected>1Â∞èÊó∂</option>
                                <option value="120">2Â∞èÊó∂</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" id="specialIntervalGroup" style="display: none;">
                        <label>‰∏éÁâõÂ•∂Èó¥ÈöîÔºàÂàÜÈíüÔºåÂèåÂêëÔºâ</label>
                        <input type="number" id="newItemSpecialInterval" placeholder="Â¶ÇÔºö30" value="30">
                    </div>
                    <div class="config-actions" style="padding: 0; margin-top: 10px;">
                        <button class="config-btn cancel" onclick="hideAddForm()">ÂèñÊ∂à</button>
                        <button class="config-btn save" onclick="addNewItem()">Ê∑ªÂä†</button>
                    </div>
                </div>
            </div>
            
            <div class="config-actions">
                <button class="config-btn cancel" onclick="closeConfig()">ÂèñÊ∂à</button>
                <button class="config-btn save" onclick="saveConfig()">‰øùÂ≠òÂπ∂ÂºÄÂßã</button>
            </div>
        </div>
    </div>

    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÊ®°ÊÄÅÊ°Ü -->
    <div class="history-modal" id="historyModal">
        <div class="history-content">
            <div class="history-header">
                <h2>üìÖ ÂéÜÂè≤ËÆ∞ÂΩï</h2>
            </div>
            <div class="history-list" id="historyList">
                <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°® -->
            </div>
            <div class="config-actions">
                <button class="config-btn cancel" onclick="closeHistory()">ÂÖ≥Èó≠</button>
                <button class="config-btn save" onclick="backToToday()">ÂõûÂà∞‰ªäÂ§©</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>
    
    <div class="celebration-overlay" id="celebrationOverlay" onclick="closeCelebration()">
        <div class="celebration" id="celebration" onclick="event.stopPropagation()">
            <div class="celebration-icon">üéâ</div>
            <h2>‰ªäÊó•ÂÆåÊàêÔºÅ</h2>
            <p id="celebrationText">ÂÆùÂÆùÁúüÊ£íÔºÅ</p>
        </div>
    </div>

    <script>
        // Â≠òÂÇ®ÈîÆÂêç
        const STORAGE_KEY = 'taotaoHealthRecords';
        const CONFIG_KEY = 'taotaoHealthConfig';
        
        // ÈªòËÆ§ÈÖçÁΩÆ
        const defaultConfig = {
            title: 'ÂÆùÂÆùÂñÇÂ•∂ËÆ∞ÂΩï',
            icon: 'üçº',
            trackType: 'milk',
            items: [
                { id: 1, name: '1', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 2, name: '2', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 3, name: '3', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 'vit', name: 'Áª¥D', icon: '‚òÄÔ∏è', type: 'vitamin', amount: '1Êª¥', interval: 30, specialInterval: { type: 'milk', minutes: 30 } },
                { id: 4, name: '4', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 5, name: '5', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 6, name: '6', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 7, name: '7', icon: 'ü•õ', type: 'milk', amount: '300ml', interval: 60 },
                { id: 'med', name: 'Ê∞ØÂê°Ê†ºÈõ∑', icon: 'üíä', type: 'medicine', amount: '4/5Áâá', interval: 0, specialInterval: { type: 'milk', minutes: 30 } }
            ],
            poopLabels: {
                normal: 'Ê≠£Â∏∏‰æø',
                diarrhea: 'Á®Ä‰æø',
                hard: 'Á°¨‰æø'
            }
        };

        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        let config = JSON.parse(JSON.stringify(defaultConfig));
        let currentDate = new Date().toDateString();
        let records = [];
        let poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
        let timeLimitEnabled = true;
        let checkInterval;
        let draggedItem = null;
        let isViewingHistory = false;

        // ÂàùÂßãÂåñ
        function init() {
            loadConfig();
            loadTodayData();
            updateDateDisplay();
            startDay();
        }

        // Âä†ËΩΩÈÖçÁΩÆ
        function loadConfig() {
            const savedConfig = localStorage.getItem(CONFIG_KEY);
            if (savedConfig) {
                config = JSON.parse(savedConfig);
            }
        }

        // ‰øùÂ≠òÈÖçÁΩÆ
        function saveConfig() {
            localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
        }

        // Âä†ËΩΩÊåáÂÆöÊó•ÊúüÁöÑÊï∞ÊçÆ
        function loadDateData(dateStr) {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const dayData = allData[dateStr];
            
            if (dayData) {
                // Â¶ÇÊûúÊúâÂ§ö‰∏™ËÆ∞ÂΩïÔºåÂèñÊúÄÊñ∞ÁöÑ‰∏Ä‰∏™
                if (Array.isArray(dayData)) {
                    const latest = dayData[dayData.length - 1];
                    records = latest.records || [];
                    poopRecords = latest.poopRecords || { normal: 0, diarrhea: 0, hard: 0, times: [] };
                    timeLimitEnabled = latest.timeLimitEnabled !== undefined ? latest.timeLimitEnabled : true;
                } else {
                    records = dayData.records || [];
                    poopRecords = dayData.poopRecords || { normal: 0, diarrhea: 0, hard: 0, times: [] };
                    timeLimitEnabled = dayData.timeLimitEnabled !== undefined ? dayData.timeLimitEnabled : true;
                }
            } else {
                // Êñ∞Êó•ÊúüÔºåÈáçÁΩÆÊï∞ÊçÆ
                records = [];
                poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
                timeLimitEnabled = true;
            }
            
            currentDate = dateStr;
            updateDateDisplay();
        }

        // Âä†ËΩΩ‰ªäÂ§©Êï∞ÊçÆ
        function loadTodayData() {
            const today = new Date().toDateString();
            loadDateData(today);
            isViewingHistory = false;
        }

        // ‰øùÂ≠òÂΩìÂâçÊó•ÊúüÊï∞ÊçÆÔºà‰∏çË¶ÜÁõñÔºåËøΩÂä†Ôºâ
        function saveCurrentData() {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            const newRecord = {
                records: JSON.parse(JSON.stringify(records)),
                poopRecords: JSON.parse(JSON.stringify(poopRecords)),
                timeLimitEnabled,
                savedAt: new Date().toISOString()
            };
            
            // Â¶ÇÊûúËØ•Êó•ÊúüÂ∑≤ÊúâËÆ∞ÂΩïÔºåËΩ¨‰∏∫Êï∞ÁªÑÂ≠òÂÇ®Â§ö‰∏™ËÆ∞ÂΩï
            if (allData[currentDate]) {
                if (Array.isArray(allData[currentDate])) {
                    allData[currentDate].push(newRecord);
                } else {
                    allData[currentDate] = [allData[currentDate], newRecord];
                }
            } else {
                allData[currentDate] = newRecord;
            }
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
        }

        // Âà†Èô§ÊåáÂÆöÊó•ÊúüÁöÑÊåáÂÆöËÆ∞ÂΩï
        function deleteHistoryRecord(dateStr, recordIndex) {
            const allData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
            
            if (!allData[dateStr]) return false;
            
            if (Array.isArray(allData[dateStr])) {
                // Âà†Èô§Êï∞ÁªÑ‰∏≠ÁöÑÊåáÂÆöËÆ∞ÂΩï
                allData[dateStr].splice(recordIndex, 1);
                // Â¶ÇÊûúÊï∞ÁªÑ‰∏∫Á©∫ÔºåÂà†Èô§ËØ•Êó•Êúü
                if (allData[dateStr].length === 0) {
                    delete allData[dateStr];
                } else if (allData[dateStr].length === 1) {
                    // Â¶ÇÊûúÂè™Ââ©‰∏Ä‰∏™ÔºåËΩ¨ÂõûÂØπË±°Ê†ºÂºè
                    allData[dateStr] = allData[dateStr][0];
                }
            } else {
                // Âà†Èô§Âçï‰∏™ËÆ∞ÂΩï
                delete allData[dateStr];
            }
            
            localStorage.setItem(STORAGE_KEY, JSON.stringify(allData));
            return true;
        }

        // ‰øùÂ≠òËÆ∞ÂΩïÊåâÈíÆÂäüËÉΩÔºà‰ªÖ‰øùÂ≠òÔºå‰∏çÈáçÁΩÆÔºâ
        function saveDayRecord() {
            if (isViewingHistory) {
                showToast('ÂéÜÂè≤ËÆ∞ÂΩï‰∏çËÉΩ‰øùÂ≠ò');
                return;
            }
            
            // ‰øùÂ≠òÂΩìÂâçËÆ∞ÂΩï
            saveCurrentData();
            
            showToast('üíæ ËÆ∞ÂΩïÂ∑≤‰øùÂ≠ò');
            
            // Ê∑ªÂä†‰øùÂ≠òÂä®ÁîªÊïàÊûú
            const btn = document.getElementById('saveBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 200);
        }

        // ÈáçÁΩÆÊåâÈíÆÂäüËÉΩÔºà‰ªÖÈáçÁΩÆÔºå‰∏ç‰øùÂ≠òÔºâ
        function resetCurrentDay() {
            if (isViewingHistory) {
                // Â¶ÇÊûúÊòØÊü•ÁúãÂéÜÂè≤ËÆ∞ÂΩïÔºåÂõûÂà∞‰ªäÂ§©
                backToToday();
                return;
            }
            
            // Á°ÆËÆ§ÂØπËØùÊ°Ü
            if (records.length > 0 || poopRecords.times.length > 0) {
                if (!confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÂΩìÂâçËÆ∞ÂΩïÂπ∂ÂºÄÂßãÊñ∞ËÆ∞ÂΩïÂêóÔºü\nÔºàËØ∑ÂÖàÁÇπÂáª"‰øùÂ≠òËÆ∞ÂΩï"‰øùÂ≠òÂΩìÂâçÊï∞ÊçÆÔºâ')) {
                    return;
                }
            }
            
            // ÈáçÁΩÆÂΩìÂâçÊï∞ÊçÆ
            records = [];
            poopRecords = { normal: 0, diarrhea: 0, hard: 0, times: [] };
            timeLimitEnabled = true;
            
            document.getElementById('toggleSwitch').classList.add('active');
            
            renderItems();
            updateStats();
            updatePoopDisplay();
            
            if (checkInterval) clearInterval(checkInterval);
            checkInterval = setInterval(updateButtonStates, 10000);
            
            document.getElementById('celebrationOverlay').classList.remove('show');
            
            showToast('üîÑ Â∑≤ÂºÄÂßãÊñ∞ËÆ∞ÂΩï');
            
            // Ê∑ªÂä†ÈáçÁΩÆÂä®ÁîªÊïàÊûú
            const btn = document.getElementById('resetBtn');
            btn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                btn.style.transform = '';
            }, 200);
        }

        // Êõ¥Êñ∞Êó•ÊúüÊòæÁ§∫
        function updateDateDisplay() {
            const date = new Date(currentDate);
            const today = new Date().toDateString();
            const yesterday = new Date(Date.now() - 86400000).toDateString();
            
            let dateText;
            if (currentDate === today) {
                dateText = '‰ªäÂ§©';
            } else if (currentDate === yesterday) {
                dateText = 'Êò®Â§©';
            } else {
                dateText = date.toLocaleDateString('zh-CN', {
                    month: 'short',
                    day: 'numeric',
                    weekday: 'short'
                });
            }
            
            document.getElementById('currentDate').textContent = dateText;
        }

        // ÂºÄÂßã/Âà∑Êñ∞ÁïåÈù¢
        function startDay() {
            document.getElementById('titleText').textContent = config.title;
            document.getElementById('titleIcon').textContent = config.icon;
            
            document.getElementById('poopLabelNormal').textContent = config.poopLabels.normal;
            document.getElementById('poopLabelDiarrhea').textContent = config.poopLabels.diarrhea;
            document.getElementById('poopLabelHard').textContent = config.poopLabels.hard;
            
            // Ê†πÊçÆÊòØÂê¶ÊòØÂéÜÂè≤ËÆ∞ÂΩïË∞ÉÊï¥ÁïåÈù¢
            const today = new Date().toDateString();
            const isToday = currentDate === today;
            
            // ÂéÜÂè≤ËÆ∞ÂΩïÁ¶ÅÁî®Êó∂Èó¥ÈôêÂà∂ÂºÄÂÖ≥Âíå‰øùÂ≠òÊåâÈíÆ
            if (!isToday) {
                document.getElementById('toggleSwitch').classList.remove('active');
                document.getElementById('saveBtn').style.display = 'none';
                document.getElementById('resetBtn').innerHTML = '<span>üè†</span> ÂõûÂà∞‰ªäÂ§©';
                isViewingHistory = true;
            } else {
                if (!timeLimitEnabled) {
                    document.getElementById('toggleSwitch').classList.remove('active');
                } else {
                    document.getElementById('toggleSwitch').classList.add('active');
                }
                document.getElementById('saveBtn').style.display = 'flex';
                document.getElementById('resetBtn').innerHTML = '<span>üîÑ</span> ÂºÄÂßãÊñ∞ËÆ∞ÂΩï';
                isViewingHistory = false;
            }
            
            updateStatsLabels();
            renderItems();
            updateStats();
            updatePoopDisplay();
            
            if (checkInterval) clearInterval(checkInterval);
            if (isToday) {
                checkInterval = setInterval(updateButtonStates, 10000);
            }
        }

        function updateStatsLabels() {
            document.getElementById('completedLabel').textContent = 'ÂñùÂ•∂ÂÆåÊàê';
            document.getElementById('remainingLabel').textContent = 'ÂñùÂ•∂Ââ©‰Ωô';
            document.getElementById('amountLabel').textContent = 'Â•∂Èáè(ml)';
        }

        function renderItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';
            
            let milkIndex = 1;
            config.items.forEach(item => {
                if (item.type === 'milk') {
                    item.name = String(milkIndex++);
                }
            });
            
            for (let i = 0; i < config.items.length; i += 4) {
                const row = document.createElement('div');
                row.className = 'item-row';
                
                for (let j = i; j < Math.min(i + 4, config.items.length); j++) {
                    const item = config.items[j];
                    const record = records.find(r => r.id === item.id);
                    const isCompleted = record && record.completed;
                    
                    const btn = document.createElement('button');
                    btn.className = `item-btn type-${item.type}`;
                    btn.id = `item-${item.id}`;
                    
                    // ÂéÜÂè≤ËÆ∞ÂΩïÊàñÂ∑≤ÂÆåÊàêÁöÑÈ°πÁõÆ‰∏çÂèØÁÇπÂáª
                    if (!isViewingHistory && !isCompleted) {
                        btn.onclick = () => recordItem(item.id);
                    } else {
                        btn.style.cursor = isCompleted ? 'default' : 'not-allowed';
                    }
                    
                    if (isCompleted) {
                        btn.classList.add('completed');
                    } else if (j === i && !isCompleted && !isViewingHistory) {
                        btn.classList.add('next');
                    }
                    
                    const timeDisplay = isCompleted ? record.timeStr : '--:--';
                    const amountValue = record ? record.amount : item.amount;
                    const inputDisabled = isCompleted || isViewingHistory ? 'disabled' : '';
                    
                    btn.innerHTML = `
                        <div class="item-icon">${item.icon}</div>
                        <div class="item-name">${item.name}</div>
                        <div class="item-time" id="time-${item.id}">${timeDisplay}</div>
                        <input type="text" class="item-amount-input" id="amount-${item.id}" value="${amountValue}" ${inputDisabled} onclick="event.stopPropagation()" onchange="updateItemAmountTemp(${item.id}, this.value)">
                    `;
                    
                    row.appendChild(btn);
                }
                
                container.appendChild(row);
            }
        }

        function updateItemAmountTemp(itemId, newAmount) {
            if (isViewingHistory) return;
            
            const item = config.items.find(i => i.id === itemId);
            if (item) {
                item.amount = newAmount;
                const record = records.find(r => r.id === itemId);
                if (record) {
                    record.amount = newAmount;
                }
                showToast('ÂÆπÈáèÂ∑≤Êõ¥Êñ∞Ôºö' + newAmount);
            }
        }

        function recordItem(id) {
            if (isViewingHistory) return;
            
            const item = config.items.find(i => i.id === id);
            const existing = records.find(r => r.id === id);
            if (existing && existing.completed) return;
            
            const now = new Date();
            
            if (timeLimitEnabled) {
                const check = checkTimeConstraints(item, now);
                if (!check.canProceed) {
                    showToast(check.message);
                    return;
                }
            }
            
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit'